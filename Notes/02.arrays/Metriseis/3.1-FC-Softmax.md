# Fc - Softmax Data

## code 
```c
239: void fc_forward(float* restrict X, FC_Layer* l, float* restrict Y) {
  // For every output neuron
  #pragma acc parallel loop present(X,l,Y) //gang worker num_gangs(10) vector_length(32) // 
  for (int i = 0; i < l->out_depth; i++) {
    // Calculate dot product of input and weights
    float sum = 0.0f;
    #pragma acc loop reduction(+:sum) //vector
    for (int j = 0; j < l->in_neurons; j++) {
        ...
...

389: void softmax_forward(float* restrict X, Softmax_Layer* l, float* restrict Y) {
  
  float max = -INFINITY;
  float total = 0.0f;
  #pragma acc data copyin(max,total) present(X,l,Y)
  {
    // Compute max activation
  #pragma acc parallel loop reduction(max:max) //vector vector_length(10)
  for (int i = 0; i < l->out_depth; i++) {
    if (X[i] > max) {
      max = X[i];
    }
  }

  // Compute exponentials and total
  
#pragma acc parallel loop reduction(+:total) //vector vector_length(10)
  for (int i = 0; i < l->out_depth; i++) {
    float e = exp(X[i] - max);
    total += e;
    l->likelihoods[i] = e;
  }

  // Normalize and output to sum to one
#pragma acc parallel loop //vector vector_length(10) 
  for (int i = 0; i < l->out_depth; i++) {
    Y[i] = l->likelihoods[i] / total;
  }
  } // acc data
}
```

## Minfo
```
$ make
nvc -acc -Minfo=all -c11 -Wall -Wextra -march=native  -c main.c -o main.o
main:
    121, Generating enter data copyin(input[:50000][:3072])
    179, Generating enter data create(O2[:L2->out_size],O1[:L1->out_size],O11[:50000][:L11->out_size],O5[:L5->out_size],O4[:L4->out_size],O3[:L3->out_size],O9[:L9->out_size],O8[:L8->out_size],O7[:L7->out_size],O6[:L6->out_size],O10[:L10->out_size])
    246, Generating update self(O11[:50000][:L11->out_size])
    311, Generating exit data delete(O2[:L2->out_size],O1[:L1->out_size],O11[:50000][:L11->out_size],O5[:L5->out_size],O4[:L4->out_size],O3[:L3->out_size],O8[:L8->out_size],O7[:L7->out_size],O6[:L6->out_size],O10[:L10->out_size],O9[:L9->out_size])
    339, Generating exit data delete(input[:50000][:3072])
arr2txt:
    362, Zero trip check eliminated
arr2txt_2:
    384, Zero trip check eliminated
nvc -acc -Minfo=all -c11 -Wall -Wextra -march=native  -c layers.c -o layers.o
make_conv_layer:
     42, Generating enter data copyin(layer[:1])
         Generating enter data create(layer->weights[:layer->weights_size])
         Generating enter data copyin(layer->in_padded[:layer->padded_size])
         Generating enter data create(layer->bias[:M])
free_conv:
     53, Generating exit data delete(l->bias[:l->out_depth],l->in_padded[:l->padded_size],l[:1],l->weights[:l->weights_size])
pad_input:
     60, Generating present(l[:],X[:])
         Generating implicit firstprivate(c)
         Generating NVIDIA GPU code
         62, #pragma acc loop gang, worker(4), vector(32) collapse(3) blockIdx.x threadIdx.y threadIdx.x */
         63,   /* blockIdx.x threadIdx.y threadIdx.x collapsed */
         64,   /* blockIdx.x threadIdx.y threadIdx.x collapsed */
conv_forward:
     77, Generating present(Y[:],l[:],X[:])
         Generating implicit firstprivate(m)
         Generating NVIDIA GPU code
         80, #pragma acc loop gang collapse(2) /* blockIdx.x */
         81,   /* blockIdx.x collapsed */
         83, #pragma acc loop worker(4) /* threadIdx.y */
         88, #pragma acc loop vector(32) /* threadIdx.x */
             Generating reduction(+:sum)
         89, #pragma acc loop seq
         90, #pragma acc loop seq
         97, Vector barrier inserted for vector loop reduction
     83, Loop is parallelizable
     88, Loop is parallelizable
     89, Loop is parallelizable
     90, Loop is parallelizable
     95, FMA (fused multiply-add) instruction(s) generated
make_relu_layer:
    126, Generating enter data copyin(layer[:1])
relu_forward:
    131, Generating present(Y[:],l[:],X[:])
         Generating implicit firstprivate(i)
         Generating NVIDIA GPU code
        133, #pragma acc loop gang, worker(4), vector(32) /* blockIdx.x threadIdx.y threadIdx.x */
free_relu:
    143, Generating exit data delete(l[:1])
make_pool_layer:
    170, Generating enter data copyin(layer[:1])
pool_forward:
    175, Generating present(Y[:],l[:],X[:])
         Generating implicit firstprivate(m)
         Generating NVIDIA GPU code
        178, #pragma acc loop gang collapse(2) /* blockIdx.x */
        179,   /* blockIdx.x collapsed */
        181, #pragma acc loop worker(4) /* threadIdx.y */
        186, #pragma acc loop vector(32) /* threadIdx.x */
             Generating reduction(max:max)
        187, #pragma acc loop seq
        194, Vector barrier inserted for vector loop reduction
    181, Loop is parallelizable
    186, Loop is parallelizable
    187, Loop is parallelizable
free_pool:
    206, Generating exit data delete(l[:1])
make_fc_layer:
    234, Generating enter data copyin(layer[:1])
         Generating enter data create(layer->weights[:layer->out_depth*layer->in_neurons],layer->bias[:layer->out_depth])
fc_forward:
    239, Generating present(l[:],Y[:],X[:])
         Generating implicit firstprivate(i)
         Generating NVIDIA GPU code
        242, #pragma acc loop gang /* blockIdx.x */
        246, #pragma acc loop vector(128) /* threadIdx.x */
             Generating reduction(+:sum)
    246, Loop is parallelizable
    248, FMA (fused multiply-add) instruction(s) generated
free_fc:
    261, Generating exit data delete(l->bias[:l->out_depth],l[:1],l->weights[:l->out_depth*l->in_neurons])
load_conv:
    310, Generating update device(l->weights[:l->weights_size],l->bias[:l->out_depth])
load_fc:
    358, Generating update device(l->weights[:l->out_depth*l->in_neurons],l->bias[:l->out_depth])
make_softmax_layer:
    384, Generating enter data copyin(layer[:1])
         Generating enter data create(layer->likelihoods[:layer->out_depth])
softmax_forward:
    394, Generating copyin(total,max) [if not already present]
         Generating present(l[:],Y[:],X[:])
         Generating implicit firstprivate(i)
         Generating NVIDIA GPU code
        397, #pragma acc loop gang, vector(128) /* blockIdx.x threadIdx.x */
             Generating reduction(max:max)
    401, Generating implicit firstprivate(i)
         Generating NVIDIA GPU code
        406, #pragma acc loop gang, vector(128) /* blockIdx.x threadIdx.x */
             Generating reduction(+:total)
    410, Generating implicit firstprivate(i)
         Generating NVIDIA GPU code
        414, #pragma acc loop gang, vector(128) /* blockIdx.x threadIdx.x */
nvc -acc -Minfo=all -c11 -Wall -Wextra -march=native  -c malloc2D.c -o malloc2D.o
nvc -acc -Minfo=all -c11 -Wall -Wextra -march=native  -c timer.c -o timer.o
cpu_timer_stop:
     11, FMA (fused multiply-add) instruction(s) generated
nvc -acc -Minfo=all -c11 -Wall -Wextra -march=native  -o cnn-cifar10 main.o layers.o malloc2D.o timer.o
```
## execution
```
$ ./cnn-cifar10 
Parallel (pad) Code
CNN for 50000 images
Loading input batch 1...
Loading input batch 2...
Loading input batch 3...
Loading input batch 4...
Loading input batch 5...
Load Data time:1.016456 seconds
Create Network time:0.038289 seconds
Load Network Parameters time:0.007728 seconds
Create Ouputs time:0.000313 seconds

Net Forward total time:12.793632 seconds
    Time for conv1: 2.547245 seconds
    Time for relu1: 0.595900 seconds
    Time for pool1: 0.702997 seconds
    Time for conv2: 2.255120 seconds
    Time for relu2: 0.599189 seconds
    Time for pool2: 0.595144 seconds
    Time for conv3: 1.478145 seconds
    Time for relu3: 0.603452 seconds
    Time for pool3: 0.534270 seconds
    Time for fc: 0.580451 seconds
    Time for softmax: 2.284960 seconds

  Conv: 6.280510 seconds
  ReLU: 1.798541 seconds
  Pool: 1.832411 seconds
  FC:   0.580451 seconds
  Softmax: 2.284960 seconds

Net Accuracy: 78.84 % 
Net Accuracy time:0.000728 seconds
Free memory time:0.042441 seconds
Total time:13.899589 seconds
END!
```

## Profile
### NV_ACC
```
$ ./cnn-cifar10 
Parallel (pad) Code
CNN for 50000 images
Loading input batch 1...
Loading input batch 2...
Loading input batch 3...
Loading input batch 4...
Loading input batch 5...
CUPTI ERROR: cuptiActivityEnable(CUPTI_ACTIVITY_KIND_KERNEL) returned: CUPTI_ERROR_INSUFFICIENT_PRIVILEGES, 
         at ../../src-cupti/prof_cuda_cupti.c:338.
Load Data time:1.125587 seconds
Create Network time:0.039003 seconds
Load Network Parameters time:0.009071 seconds
Create Ouputs time:0.000397 seconds

Net Forward total time:17.906615 seconds
    Time for conv1: 2.993044 seconds
    Time for relu1: 0.818687 seconds
    Time for pool1: 0.930962 seconds
    Time for conv2: 2.703649 seconds
    Time for relu2: 0.814268 seconds
    Time for pool2: 0.820969 seconds
    Time for conv3: 1.936807 seconds
    Time for relu3: 0.821844 seconds
    Time for pool3: 0.761746 seconds
    Time for fc: 0.815328 seconds
    Time for softmax: 4.472209 seconds

  Conv: 7.633500 seconds
  ReLU: 2.454799 seconds
  Pool: 2.513678 seconds
  FC:   0.815328 seconds
  Softmax: 4.472209 seconds

Net Accuracy: 78.84 % 
Net Accuracy time:0.000769 seconds
Free memory time:0.038060 seconds
Total time:19.119501 seconds
END!

Accelerator Kernel Timing data
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  make_conv_layer  NVIDIA  devicenum=0
    time(us): 224
    42: data region reached 9 times
        42: data copyin transfers: 24
             device time(us): total=224 max=28 min=3 avg=9
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  free_conv  NVIDIA  devicenum=0
    time(us): 126
    53: data region reached 9 times
        53: data copyin transfers: 18
             device time(us): total=126 max=12 min=3 avg=7
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  pad_input  NVIDIA  devicenum=0
    time(us): 0
    60: compute region reached 150000 times
        60: kernel launched 150000 times
            grid: [800]  block: [32x4]
            elapsed time(us): total=1,801,482 max=409 min=11 avg=12
    60: data region reached 300000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  conv_forward  NVIDIA  devicenum=0
    time(us): 0
    77: compute region reached 150000 times
        77: kernel launched 150000 times
            grid: [160-512]  block: [32x4]
            elapsed time(us): total=4,754,227 max=393 min=18 avg=31
    77: data region reached 300000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  make_relu_layer  NVIDIA  devicenum=0
    time(us): 11
    126: data region reached 3 times
        126: data copyin transfers: 3
             device time(us): total=11 max=4 min=3 avg=3
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  relu_forward  NVIDIA  devicenum=0
    time(us): 0
    131: compute region reached 150000 times
        131: kernel launched 150000 times
            grid: [1280]  block: [32x4]
            elapsed time(us): total=1,875,968 max=2,124 min=11 avg=12
    131: data region reached 300000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  free_relu  NVIDIA  devicenum=0
    time(us): 0
    143: data region reached 3 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  make_pool_layer  NVIDIA  devicenum=0
    time(us): 10
    170: data region reached 3 times
        170: data copyin transfers: 3
             device time(us): total=10 max=4 min=3 avg=3
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  pool_forward  NVIDIA  devicenum=0
    time(us): 0
    175: compute region reached 150000 times
        175: kernel launched 150000 times
            grid: [80-256]  block: [32x4]
            elapsed time(us): total=1,952,743 max=313 min=11 avg=13
    175: data region reached 300000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  free_pool  NVIDIA  devicenum=0
    time(us): 0
    206: data region reached 3 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  make_fc_layer  NVIDIA  devicenum=0
    time(us): 33
    234: data region reached 2 times
        234: data copyin transfers: 5
             device time(us): total=33 max=12 min=3 avg=6
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  fc_forward  NVIDIA  devicenum=0
    time(us): 0
    239: compute region reached 50000 times
        239: kernel launched 50000 times
            grid: [960]  block: [128]
            elapsed time(us): total=614,923 max=2,015 min=11 avg=12
    239: data region reached 100000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  free_fc  NVIDIA  devicenum=0
    time(us): 77
    261: data region reached 2 times
        261: data copyin transfers: 4
             device time(us): total=77 max=24 min=14 avg=19
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  load_conv  NVIDIA  devicenum=0
    time(us): 57
    310: update directive reached 3 times
        310: data copyin transfers: 6
             device time(us): total=57 max=24 min=3 avg=9
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  load_fc  NVIDIA  devicenum=0
    time(us): 14
    358: update directive reached 1 time
        358: data copyin transfers: 2
             device time(us): total=14 max=10 min=4 avg=7
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  make_softmax_layer  NVIDIA  devicenum=0
    time(us): 22
    384: data region reached 2 times
        384: data copyin transfers: 3
             device time(us): total=22 max=13 min=4 avg=7
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  softmax_forward  NVIDIA  devicenum=0
    time(us): 291,770
    394: compute region reached 50000 times
        394: kernel launched 50000 times
            grid: [1280]  block: [128]
            elapsed time(us): total=651,251 max=45 min=12 avg=13
        394: reduction kernel launched 50000 times
            grid: [1]  block: [256]
            elapsed time(us): total=572,120 max=43 min=10 avg=11
    394: data region reached 100000 times
        394: data copyin transfers: 100000
             device time(us): total=291,770 max=19 min=2 avg=2
    401: compute region reached 50000 times
        401: kernel launched 50000 times
            grid: [1280]  block: [128]
            elapsed time(us): total=644,026 max=46 min=12 avg=12
        401: reduction kernel launched 50000 times
            grid: [1]  block: [256]
            elapsed time(us): total=574,419 max=34 min=10 avg=11
    410: compute region reached 50000 times
        410: kernel launched 50000 times
            grid: [1280]  block: [128]
            elapsed time(us): total=615,561 max=302 min=11 avg=12
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/main.c
  main  NVIDIA  devicenum=0
    time(us): 146,125
    121: data region reached 1 time
        44: kernel launched 1 time
            grid: [391]  block: [128]
            elapsed time(us): total=47 max=47 min=47 avg=47
        121: data copyin transfers: 1
             device time(us): total=144,172 max=144,172 min=144,172 avg=144,172
    179: data region reached 4 times
        44: kernel launched 1 time
            grid: [391]  block: [128]
            elapsed time(us): total=37 max=37 min=37 avg=37
    246: update directive reached 1 time
        246: data copyout transfers: 1
             device time(us): total=1,953 max=1,953 min=1,953 avg=1,953
    311: data region reached 4 times
    339: data region reached 1 time
```

## nvporf
```
$ nvprof ./cnn-cifar10-profile 
Parallel (pad) Code
CNN for 50000 images
Loading input batch 1...
Loading input batch 2...
Loading input batch 3...
Loading input batch 4...
Loading input batch 5...
==2768853== NVPROF is profiling process 2768853, command: ./cnn-cifar10-profile
Load Data time:1.290450 seconds
Create Network time:0.039099 seconds
Load Network Parameters time:0.008199 seconds
Create Ouputs time:0.000338 seconds

Net Forward total time:21.433183 seconds
    Time for conv1: 3.728214 seconds
    Time for relu1: 1.136415 seconds
    Time for pool1: 1.212837 seconds
    Time for conv2: 3.392731 seconds
    Time for relu2: 1.116350 seconds
    Time for pool2: 1.098298 seconds
    Time for conv3: 2.514268 seconds
    Time for relu3: 1.110605 seconds
    Time for pool3: 1.026876 seconds
    Time for fc: 1.120672 seconds
    Time for softmax: 3.948656 seconds

  Conv: 9.635213 seconds
  ReLU: 3.363370 seconds
  Pool: 3.338010 seconds
  FC:   1.120672 seconds
  Softmax: 3.948656 seconds

Net Accuracy: 78.84 % 
Net Accuracy time:0.000719 seconds
Free memory time:0.045207 seconds
Total time:22.817194 seconds
END!
==2768853== Profiling application: ./cnn-cifar10-profile
==2768853== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   54.97%  3.81070s    150000  25.404us  11.519us  36.319us  _8layers_c_conv_forward_77_gpu
                    9.83%  681.36ms    150000  4.5420us  2.9110us  13.695us  _8layers_c_pool_forward_175_gpu
                    8.43%  584.27ms    150000  3.8950us  3.8390us  13.567us  _8layers_c_relu_forward_131_gpu
                    7.46%  516.77ms    150000  3.4450us  3.3910us  13.568us  _8layers_c_pad_input_60_gpu
                    3.29%  227.96ms     50000  4.5590us  4.5110us  13.440us  _8layers_c_softmax_forward_394_gpu
                    3.27%  226.80ms     50000  4.5360us  4.4790us  13.279us  _8layers_c_softmax_forward_401_gpu
                    2.80%  194.39ms     50000  3.8870us  3.8390us  13.472us  _8layers_c_softmax_forward_410_gpu
                    2.65%  183.95ms     50000  3.6790us  3.6150us  13.312us  _8layers_c_fc_forward_239_gpu
                    2.11%  146.17ms     50000  2.9230us  2.8790us  13.184us  _8layers_c_softmax_forward_401_gpu__red
                    2.07%  143.52ms     50000  2.8700us  2.8150us  13.376us  _8layers_c_softmax_forward_394_gpu__red
                    2.02%  140.02ms        46  3.0439ms     736ns  139.97ms  [CUDA memcpy HtoD]
                    1.09%  75.758ms    100000     757ns     735ns  1.1520us  [CUDA memset]
                    0.00%  155.71us         1  155.71us  155.71us  155.71us  [CUDA memcpy DtoH]
                    0.00%  5.1520us         2  2.5760us  2.5280us  2.6240us  _21______src_cuda_fill_c___pgi_uacc_cuda_fill_44_gpu
      API calls:   65.74%  9.06955s   1500029  6.0460us     861ns  2.4610ms  cuStreamSynchronize
                   26.33%  3.63204s    900002  4.0350us  2.9680us  13.356ms  cuLaunchKernel
                    2.09%  288.89ms   1000000     288ns     175ns  4.8799ms  cuOccupancyMaxActiveBlocksPerMultiprocessor
                    1.93%  266.28ms    100000  2.6620us  1.8240us  1.2030ms  cuMemsetD32Async
                    1.16%  160.26ms         1  160.26ms  160.26ms  160.26ms  cuDevicePrimaryCtxRetain
                    1.15%  159.04ms    800011     198ns     116ns  797.21us  cuDeviceGetAttribute
                    1.02%  140.41ms        46  3.0524ms  2.5860us  140.16ms  cuMemcpyHtoDAsync
                    0.28%  38.452ms         1  38.452ms  38.452ms  38.452ms  cuMemHostAlloc
                    0.26%  35.202ms    100038     351ns     233ns  780.35us  cuPointerGetAttributes
                    0.01%  1.9288ms         1  1.9288ms  1.9288ms  1.9288ms  cuMemcpyDtoHAsync
                    0.01%  1.4866ms         1  1.4866ms  1.4866ms  1.4866ms  cuMemAllocHost
                    0.01%  1.2137ms         2  606.83us  109.67us  1.1040ms  cuModuleLoadDataEx
                    0.01%  876.71us        41  21.383us  1.8760us  201.60us  cuMemAlloc
                    0.00%  27.459us         1  27.459us  27.459us  27.459us  cuCtxGetCurrent
                    0.00%  9.1630us         1  9.1630us  9.1630us  9.1630us  cuDeviceGetPCIBusId
                    0.00%  7.3010us        12     608ns     328ns  1.6810us  cuModuleGetFunction
                    0.00%  3.2570us         3  1.0850us     195ns  1.7910us  cuCtxSetCurrent
                    0.00%  2.3390us         3     779ns     161ns  1.9560us  cuDeviceGetCount
                    0.00%     966ns         3     322ns     160ns     503ns  cuDriverGetVersion
                    0.00%     698ns         2     349ns     157ns     541ns  cuDeviceGet
                    0.00%     503ns         1     503ns     503ns     503ns  cuDeviceComputeCapability
 OpenACC (excl):  100.00%  1.7e+10s         1  1.7e+10s  1.7e+10s  1.7e+10s  acc_enter_data@main.c:121
                    0.00%  4.57064s    300000  15.235us  1.6700us  1.1630ms  acc_wait@layers.c:77
                    0.00%  1.44933s    300000  4.8310us  1.6640us  815.51us  acc_wait@layers.c:175
                    0.00%  1.34444s    300000  4.4810us  1.6620us  1.6969ms  acc_wait@layers.c:131
                    0.00%  1.28563s    300000  4.2850us  1.6690us  851.23us  acc_wait@layers.c:60
                    0.00%  784.75ms    150000  5.2310us  4.1860us  4.2561ms  acc_enqueue_launch@layers.c:175 (_8layers_c_pool_forward_175_gpu)
                    0.00%  780.11ms    150000  5.2000us  4.1080us  13.359ms  acc_enqueue_launch@layers.c:77 (_8layers_c_conv_forward_77_gpu)
                    0.00%  778.16ms    150000  5.1870us  4.2450us  3.0911ms  acc_enqueue_launch@layers.c:131 (_8layers_c_relu_forward_131_gpu)
                    0.00%  770.82ms    150000  5.1380us  4.1410us  2.1797ms  acc_enqueue_launch@layers.c:60 (_8layers_c_pad_input_60_gpu)
                    0.00%  501.17ms    100000  5.0110us  2.0240us  798.03us  acc_wait@layers.c:394
                    0.00%  453.90ms    150000  3.0260us  2.4250us  1.8392ms  acc_compute_construct@layers.c:60
                    0.00%  444.00ms    150000  2.9600us  2.3870us  2.6298ms  acc_compute_construct@layers.c:131
                    0.00%  425.05ms    100000  4.2500us  1.6670us  131.85us  acc_wait@layers.c:239
                    0.00%  344.91ms     50000  6.8980us  2.0200us  2.4713ms  acc_wait@layers.c:410
                    0.00%  341.38ms     50000  6.8270us  2.0540us  763.21us  acc_wait@layers.c:401
                    0.00%  329.15ms    150000  2.1940us  1.7390us  967.65us  acc_enter_data@layers.c:175
                    0.00%  328.10ms    150000  2.1870us  1.7500us  768.55us  acc_enter_data@layers.c:131
                    0.00%  323.78ms    150000  2.1580us  1.6910us  3.1070ms  acc_enter_data@layers.c:77
                    0.00%  315.96ms     50000  6.3190us  5.4030us  37.973us  acc_enter_data@layers.c:394
                    0.00%  297.83ms    150000  1.9850us  1.5520us  836.40us  acc_exit_data@layers.c:175
                    0.00%  293.58ms    150000  1.9570us  1.5740us  2.3755ms  acc_compute_construct@layers.c:77
                    0.00%  291.82ms    150000  1.9450us  1.5700us  799.34us  acc_compute_construct@layers.c:175
                    0.00%  287.41ms    150000  1.9160us  1.5190us  803.61us  acc_exit_data@layers.c:77
                    0.00%  283.37ms     50000  5.6670us  4.5870us  772.31us  acc_enqueue_launch@layers.c:394 (_8layers_c_softmax_forward_394_gpu)
                    0.00%  281.90ms    150000  1.8790us  1.5880us  751.87us  acc_exit_data@layers.c:131
                    0.00%  274.60ms    150000  1.8300us  1.3900us  787.14us  acc_enter_data@layers.c:60
                    0.00%  259.26ms     50000  5.1850us  4.1440us  822.74us  acc_enqueue_launch@layers.c:239 (_8layers_c_fc_forward_239_gpu)
                    0.00%  253.17ms     50000  5.0630us  4.0610us  770.01us  acc_enqueue_launch@layers.c:394 (_8layers_c_softmax_forward_394_gpu__red)
                    0.00%  249.59ms     50000  4.9910us  4.0580us  837.81us  acc_enqueue_launch@layers.c:410 (_8layers_c_softmax_forward_410_gpu)
                    0.00%  249.32ms     50000  4.9860us  4.0090us  778.95us  acc_enqueue_launch@layers.c:401 (_8layers_c_softmax_forward_401_gpu)
                    0.00%  238.05ms     50000  4.7600us  3.9310us  752.75us  acc_enqueue_launch@layers.c:401 (_8layers_c_softmax_forward_401_gpu__red)
                    0.00%  228.00ms    150000  1.5200us  1.2540us  37.074us  acc_exit_data@layers.c:60
                    0.00%  222.46ms     50000  4.4490us  3.6100us  764.05us  acc_exit_data@layers.c:394
                    0.00%  198.35ms     50000  3.9670us  2.9780us  1.2051ms  acc_enqueue_upload@layers.c:394 (max)
                    0.00%  176.30ms     50000  3.5250us  2.7920us  811.76us  acc_compute_construct@layers.c:394
                    0.00%  175.00ms     50000  3.4990us  2.6330us  9.2480ms  acc_compute_construct@layers.c:401
                    0.00%  155.20ms     50000  3.1040us  2.4250us  780.76us  acc_compute_construct@layers.c:239
                    0.00%  150.46ms     50000  3.0090us  2.5210us  139.80us  acc_enqueue_upload@layers.c:394 (total)
                    0.00%  140.17ms         1  140.17ms  140.17ms  140.17ms  acc_enqueue_upload@main.c:121 (input[:50000][:3072])
                    0.00%  135.99ms     50000  2.7190us  2.3330us  34.559us  acc_compute_construct@layers.c:410
                    0.00%  110.83ms     50000  2.2160us  1.6510us  831.12us  acc_exit_data@layers.c:239
                    0.00%  108.47ms     50000  2.1690us  1.8380us  27.163us  acc_enter_data@layers.c:239
                    0.00%  38.642ms         9  4.2936ms  6.2410us  38.508ms  acc_enter_data@layers.c:42
                    0.00%  29.624ms         4  7.4061ms  16.237us  29.556ms  acc_enter_data@main.c:179
                    0.00%  1.9321ms         1  1.9321ms  1.9321ms  1.9321ms  acc_enqueue_download@main.c:246 (O11[:50000][:L11->out_size])
                    0.00%  1.1973ms         1  1.1973ms  1.1973ms  1.1973ms  acc_device_init@main.c:121
                    0.00%  1.0636ms         1  1.0636ms  1.0636ms  1.0636ms  acc_exit_data@main.c:339
                    0.00%  1.0394ms         1  1.0394ms  1.0394ms  1.0394ms  acc_update@main.c:246
                    0.00%  991.34us         4  247.84us  4.4240us  971.36us  acc_exit_data@main.c:311
                    0.00%  90.495us        18  5.0270us     853ns  36.612us  acc_enqueue_upload@layers.c:42 (.attach.)
                    0.00%  82.523us         2  41.261us  35.682us  46.841us  acc_enqueue_launch@(runtime):44 (_21______src_cuda_fill_c___pgi_uacc_cuda_fill_44_gpu)
                    0.00%  69.208us         1  69.208us  69.208us  69.208us  acc_wait@main.c:121
                    0.00%  55.972us         9  6.2190us  4.4410us  9.2050us  acc_wait@layers.c:42
                    0.00%  45.048us        18  2.5020us     895ns  6.0090us  acc_enqueue_upload@layers.c:53 (.detach.)
                    0.00%  40.030us         3  13.343us  7.1090us  18.032us  acc_enqueue_upload@layers.c:310 (l->weights[:l->weights_size])
                    0.00%  30.366us         3  10.122us  7.5220us  11.925us  acc_enqueue_upload@layers.c:42 (layer->in_padded[:layer->padded_size])
                    0.00%  29.216us         9  3.2460us  1.6530us  6.5320us  acc_exit_data@layers.c:53
                    0.00%  29.122us         4  7.2800us     997ns  20.623us  acc_enqueue_upload@layers.c:261 (.detach.)
                    0.00%  23.523us         3  7.8410us  6.3100us  10.844us  acc_enter_data@layers.c:170
                    0.00%  22.654us         3  7.5510us  3.9270us  9.5350us  acc_wait@layers.c:310
                    0.00%  22.562us         3  7.5200us  1.8300us  18.285us  acc_exit_data@layers.c:206
                    0.00%  22.043us         2  11.021us  9.5350us  12.508us  acc_enter_data@layers.c:234
                    0.00%  20.950us         3  6.9830us  3.5580us  13.741us  acc_enqueue_upload@layers.c:42 (layer[:1])
                    0.00%  20.700us         3  6.9000us  6.4890us  7.6890us  acc_enter_data@layers.c:126
                    0.00%  16.344us         2  8.1720us  6.9300us  9.4140us  acc_enter_data@layers.c:384
                    0.00%  14.407us         3  4.8020us  4.7380us  4.9270us  acc_wait@layers.c:170
                    0.00%  14.316us         3  4.7720us  4.6520us  4.8940us  acc_wait@layers.c:126
                    0.00%  14.150us         2  7.0750us  1.9990us  12.151us  acc_exit_data@layers.c:261
                    0.00%  14.044us         3  4.6810us  2.7790us  7.8770us  acc_update@layers.c:310
                    0.00%  11.866us         3  3.9550us  3.6590us  4.2240us  acc_enqueue_upload@layers.c:126 (layer[:1])
                    0.00%  11.016us         3  3.6720us  3.3180us  4.1200us  acc_enqueue_upload@layers.c:310 (l->bias[:l->out_depth])
                    0.00%  10.891us         3  3.6300us  3.4560us  3.7940us  acc_enqueue_upload@layers.c:170 (layer[:1])
                    0.00%  10.468us         4  2.6170us  1.4860us  5.0810us  acc_wait@main.c:179
                    0.00%  9.6300us         2  4.8150us  4.6360us  4.9940us  acc_wait@layers.c:384
                    0.00%  9.3370us         2  4.6680us  4.5510us  4.7860us  acc_wait@layers.c:234
                    0.00%  9.2670us         4  2.3160us     838ns  3.7680us  acc_enqueue_upload@layers.c:234 (.attach.)
                    0.00%  9.2060us         1  9.2060us  9.2060us  9.2060us  acc_enqueue_upload@layers.c:358 (l->weights[:l->out_depth*l->in_neurons])
                    0.00%  5.5990us         1  5.5990us  5.5990us  5.5990us  acc_wait@main.c:246
                    0.00%  5.4960us         3  1.8320us  1.6450us  2.2050us  acc_exit_data@layers.c:143
                    0.00%  5.2750us         2  2.6370us     923ns  4.3520us  acc_enqueue_upload@layers.c:384 (.attach.)
                    0.00%  5.2640us         1  5.2640us  5.2640us  5.2640us  acc_wait@layers.c:358
                    0.00%  3.7180us         1  3.7180us  3.7180us  3.7180us  acc_enqueue_upload@layers.c:384 (layer[:1])
                    0.00%  3.5280us         1  3.5280us  3.5280us  3.5280us  acc_enqueue_upload@layers.c:234 (layer[:1])
                    0.00%  3.5080us         1  3.5080us  3.5080us  3.5080us  acc_enqueue_upload@layers.c:358 (l->bias[:l->out_depth])
                    0.00%  3.1060us         1  3.1060us  3.1060us  3.1060us  acc_update@layers.c:358
                    0.00%       0ns         2       0ns       0ns       0ns  acc_alloc@main.c:121
                    0.00%       0ns         3       0ns       0ns       0ns  acc_delete@layers.c:206
                    0.00%       0ns         3       0ns       0ns       0ns  acc_alloc@layers.c:170
                    0.00%       0ns         2       0ns       0ns       0ns  acc_create@layers.c:384
                    0.00%       0ns         2       0ns       0ns       0ns  acc_delete@main.c:339
                    0.00%       0ns        12       0ns       0ns       0ns  acc_create@main.c:179
                    0.00%       0ns    100000       0ns       0ns       0ns  acc_create@layers.c:394
                    0.00%       0ns        12       0ns       0ns       0ns  acc_alloc@layers.c:42
                    0.00%       0ns        12       0ns       0ns       0ns  acc_create@layers.c:42
                    0.00%       0ns         3       0ns       0ns       0ns  acc_alloc@layers.c:234
                    0.00%       0ns         3       0ns       0ns       0ns  acc_create@layers.c:170
                    0.00%       0ns         3       0ns       0ns       0ns  acc_alloc@layers.c:126
                    0.00%       0ns         2       0ns       0ns       0ns  acc_create@main.c:121
                    0.00%       0ns        12       0ns       0ns       0ns  acc_delete@layers.c:53
                    0.00%       0ns        12       0ns       0ns       0ns  acc_alloc@main.c:179
                    0.00%       0ns    100000       0ns       0ns       0ns  acc_delete@layers.c:417
                    0.00%       0ns         2       0ns       0ns       0ns  acc_alloc@layers.c:384
                    0.00%       0ns         3       0ns       0ns       0ns  acc_create@layers.c:234
                    0.00%       0ns         3       0ns       0ns       0ns  acc_delete@layers.c:261
                    0.00%       0ns         3       0ns       0ns       0ns  acc_delete@layers.c:143
                    0.00%       0ns         2       0ns       0ns       0ns  acc_alloc@layers.c:394
                    0.00%       0ns         3       0ns       0ns       0ns  acc_create@layers.c:126
                    0.00%       0ns        12       0ns       0ns       0ns  acc_delete@main.c:311
```
# FC -Loop opt

## code
```c
void fc_forward(float* restrict X, FC_Layer* l, float* restrict Y) {
  // For every output neuron
  #pragma acc parallel loop present(X,l,Y) gang worker //num_gangs(10) vector_length(32) // 
  for (int i = 0; i < l->out_depth; i++) {
    // Calculate dot product of input and weights
    float sum = 0.0f;
    #pragma acc loop reduction(+:sum) vector
    for (int j = 0; j < l->in_neurons; j++) {
        ...
```

## Minfo
```
$ make
nvc -acc -Minfo=all -c11 -Wall -Wextra -march=native  -c main.c -o main.o
main:
    121, Generating enter data copyin(input[:50000][:3072])
    179, Generating enter data create(O2[:L2->out_size],O1[:L1->out_size],O11[:50000][:L11->out_size],O5[:L5->out_size],O4[:L4->out_size],O3[:L3->out_size],O9[:L9->out_size],O8[:L8->out_size],O7[:L7->out_size],O6[:L6->out_size],O10[:L10->out_size])
    246, Generating update self(O11[:50000][:L11->out_size])
    311, Generating exit data delete(O2[:L2->out_size],O1[:L1->out_size],O11[:50000][:L11->out_size],O5[:L5->out_size],O4[:L4->out_size],O3[:L3->out_size],O8[:L8->out_size],O7[:L7->out_size],O6[:L6->out_size],O10[:L10->out_size],O9[:L9->out_size])
    339, Generating exit data delete(input[:50000][:3072])
arr2txt:
    362, Zero trip check eliminated
arr2txt_2:
    384, Zero trip check eliminated
nvc -acc -Minfo=all -c11 -Wall -Wextra -march=native  -c layers.c -o layers.o
make_conv_layer:
     42, Generating enter data copyin(layer[:1])
         Generating enter data create(layer->weights[:layer->weights_size])
         Generating enter data copyin(layer->in_padded[:layer->padded_size])
         Generating enter data create(layer->bias[:M])
free_conv:
     53, Generating exit data delete(l->bias[:l->out_depth],l->in_padded[:l->padded_size],l[:1],l->weights[:l->weights_size])
pad_input:
     60, Generating present(l[:],X[:])
         Generating implicit firstprivate(c)
         Generating NVIDIA GPU code
         62, #pragma acc loop gang, worker(4), vector(32) collapse(3) blockIdx.x threadIdx.y threadIdx.x */
         63,   /* blockIdx.x threadIdx.y threadIdx.x collapsed */
         64,   /* blockIdx.x threadIdx.y threadIdx.x collapsed */
conv_forward:
     77, Generating present(Y[:],l[:],X[:])
         Generating implicit firstprivate(m)
         Generating NVIDIA GPU code
         80, #pragma acc loop gang collapse(2) /* blockIdx.x */
         81,   /* blockIdx.x collapsed */
         83, #pragma acc loop worker(4) /* threadIdx.y */
         88, #pragma acc loop vector(32) /* threadIdx.x */
             Generating reduction(+:sum)
         89, #pragma acc loop seq
         90, #pragma acc loop seq
         97, Vector barrier inserted for vector loop reduction
     83, Loop is parallelizable
     88, Loop is parallelizable
     89, Loop is parallelizable
     90, Loop is parallelizable
     95, FMA (fused multiply-add) instruction(s) generated
make_relu_layer:
    126, Generating enter data copyin(layer[:1])
relu_forward:
    131, Generating present(Y[:],l[:],X[:])
         Generating implicit firstprivate(i)
         Generating NVIDIA GPU code
        133, #pragma acc loop gang, worker(4), vector(32) /* blockIdx.x threadIdx.y threadIdx.x */
free_relu:
    143, Generating exit data delete(l[:1])
make_pool_layer:
    170, Generating enter data copyin(layer[:1])
pool_forward:
    175, Generating present(Y[:],l[:],X[:])
         Generating implicit firstprivate(m)
         Generating NVIDIA GPU code
        178, #pragma acc loop gang collapse(2) /* blockIdx.x */
        179,   /* blockIdx.x collapsed */
        181, #pragma acc loop worker(4) /* threadIdx.y */
        186, #pragma acc loop vector(32) /* threadIdx.x */
             Generating reduction(max:max)
        187, #pragma acc loop seq
        194, Vector barrier inserted for vector loop reduction
    181, Loop is parallelizable
    186, Loop is parallelizable
    187, Loop is parallelizable
free_pool:
    206, Generating exit data delete(l[:1])
make_fc_layer:
    234, Generating enter data copyin(layer[:1])
         Generating enter data create(layer->weights[:layer->out_depth*layer->in_neurons],layer->bias[:layer->out_depth])
fc_forward:
    239, Generating present(l[:],Y[:],X[:])
         Generating implicit firstprivate(i)
         Generating NVIDIA GPU code
        242, #pragma acc loop gang, worker(4) /* blockIdx.x threadIdx.y */
        246, #pragma acc loop vector(32) /* threadIdx.x */
             Generating reduction(+:sum)
        248, Vector barrier inserted for vector loop reduction
    246, Loop is parallelizable
    248, FMA (fused multiply-add) instruction(s) generated
free_fc:
    261, Generating exit data delete(l->bias[:l->out_depth],l[:1],l->weights[:l->out_depth*l->in_neurons])
load_conv:
    310, Generating update device(l->weights[:l->weights_size],l->bias[:l->out_depth])
load_fc:
    358, Generating update device(l->weights[:l->out_depth*l->in_neurons],l->bias[:l->out_depth])
make_softmax_layer:
    384, Generating enter data copyin(layer[:1])
         Generating enter data create(layer->likelihoods[:layer->out_depth])
softmax_forward:
    394, Generating copyin(total,max) [if not already present]
         Generating present(l[:],Y[:],X[:])
         Generating implicit firstprivate(i)
         Generating NVIDIA GPU code
        397, #pragma acc loop gang, vector(128) /* blockIdx.x threadIdx.x */
             Generating reduction(max:max)
    401, Generating implicit firstprivate(i)
         Generating NVIDIA GPU code
        406, #pragma acc loop gang, vector(128) /* blockIdx.x threadIdx.x */
             Generating reduction(+:total)
    410, Generating implicit firstprivate(i)
         Generating NVIDIA GPU code
        414, #pragma acc loop gang, vector(128) /* blockIdx.x threadIdx.x */
nvc -acc -Minfo=all -c11 -Wall -Wextra -march=native  -c malloc2D.c -o malloc2D.o
nvc -acc -Minfo=all -c11 -Wall -Wextra -march=native  -c timer.c -o timer.o
cpu_timer_stop:
     11, FMA (fused multiply-add) instruction(s) generated
nvc -acc -Minfo=all -c11 -Wall -Wextra -march=native  -o cnn-cifar10 main.o layers.o malloc2D.o timer.o
```
## execution

```
$ ./cnn-cifar10 
Parallel (pad) Code
CNN for 50000 images
Loading input batch 1...
Loading input batch 2...
Loading input batch 3...
Loading input batch 4...
Loading input batch 5...
Load Data time:1.002273 seconds
Create Network time:0.040069 seconds
Load Network Parameters time:0.008250 seconds
Create Ouputs time:0.000334 seconds

Net Forward total time:12.426059 seconds
    Time for conv1: 2.505570 seconds
    Time for relu1: 0.574260 seconds
    Time for pool1: 0.675937 seconds
    Time for conv2: 2.210113 seconds
    Time for relu2: 0.579934 seconds
    Time for pool2: 0.570409 seconds
    Time for conv3: 1.439185 seconds
    Time for relu3: 0.585051 seconds
    Time for pool3: 0.505549 seconds
    Time for fc: 0.565410 seconds
    Time for softmax: 2.197723 seconds

  Conv: 6.154868 seconds
  ReLU: 1.739246 seconds
  Pool: 1.751894 seconds
  FC:   0.565410 seconds
  Softmax: 2.197723 seconds

Net Accuracy: 78.84 % 
Net Accuracy time:0.000718 seconds
Free memory time:0.044548 seconds
Total time:13.522251 seconds
```

## Profiling
### NV_ACC
```
$ ./cnn-cifar10 
Parallel (pad) Code
CNN for 50000 images
Loading input batch 1...
Loading input batch 2...
Loading input batch 3...
Loading input batch 4...
Loading input batch 5...
CUPTI ERROR: cuptiActivityEnable(CUPTI_ACTIVITY_KIND_KERNEL) returned: CUPTI_ERROR_INSUFFICIENT_PRIVILEGES, 
         at ../../src-cupti/prof_cuda_cupti.c:338.
Load Data time:1.146551 seconds
Create Network time:0.042536 seconds
Load Network Parameters time:0.008806 seconds
Create Ouputs time:0.000354 seconds

Net Forward total time:17.920606 seconds
    Time for conv1: 3.006605 seconds
    Time for relu1: 0.820188 seconds
    Time for pool1: 0.931024 seconds
    Time for conv2: 2.708491 seconds
    Time for relu2: 0.813817 seconds
    Time for pool2: 0.816925 seconds
    Time for conv3: 1.932954 seconds
    Time for relu3: 0.817870 seconds
    Time for pool3: 0.760940 seconds
    Time for fc: 0.824250 seconds
    Time for softmax: 4.470418 seconds

  Conv: 7.648050 seconds
  ReLU: 2.451875 seconds
  Pool: 2.508889 seconds
  FC:   0.824250 seconds
  Softmax: 4.470418 seconds

Net Accuracy: 78.84 % 
Net Accuracy time:0.000750 seconds
Free memory time:0.050107 seconds
Total time:19.169710 seconds
END!

Accelerator Kernel Timing data
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  make_conv_layer  NVIDIA  devicenum=0
    time(us): 240
    42: data region reached 9 times
        42: data copyin transfers: 24
             device time(us): total=240 max=27 min=3 avg=10
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  free_conv  NVIDIA  devicenum=0
    time(us): 129
    53: data region reached 9 times
        53: data copyin transfers: 18
             device time(us): total=129 max=13 min=3 avg=7
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  pad_input  NVIDIA  devicenum=0
    time(us): 0
    60: compute region reached 150000 times
        60: kernel launched 150000 times
            grid: [800]  block: [32x4]
            elapsed time(us): total=1,809,548 max=48 min=11 avg=12
    60: data region reached 300000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  conv_forward  NVIDIA  devicenum=0
    time(us): 0
    77: compute region reached 150000 times
        77: kernel launched 150000 times
            grid: [160-512]  block: [32x4]
            elapsed time(us): total=4,779,382 max=3,749 min=18 avg=31
    77: data region reached 300000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  make_relu_layer  NVIDIA  devicenum=0
    time(us): 10
    126: data region reached 3 times
        126: data copyin transfers: 3
             device time(us): total=10 max=4 min=3 avg=3
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  relu_forward  NVIDIA  devicenum=0
    time(us): 0
    131: compute region reached 150000 times
        131: kernel launched 150000 times
            grid: [1280]  block: [32x4]
            elapsed time(us): total=1,877,747 max=365 min=11 avg=12
    131: data region reached 300000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  free_relu  NVIDIA  devicenum=0
    time(us): 0
    143: data region reached 3 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  make_pool_layer  NVIDIA  devicenum=0
    time(us): 10
    170: data region reached 3 times
        170: data copyin transfers: 3
             device time(us): total=10 max=4 min=3 avg=3
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  pool_forward  NVIDIA  devicenum=0
    time(us): 0
    175: compute region reached 150000 times
        175: kernel launched 150000 times
            grid: [80-256]  block: [32x4]
            elapsed time(us): total=1,957,013 max=349 min=11 avg=13
    175: data region reached 300000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  free_pool  NVIDIA  devicenum=0
    time(us): 0
    206: data region reached 3 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  make_fc_layer  NVIDIA  devicenum=0
    time(us): 33
    234: data region reached 2 times
        234: data copyin transfers: 5
             device time(us): total=33 max=12 min=3 avg=6
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  fc_forward  NVIDIA  devicenum=0
    time(us): 0
    239: compute region reached 50000 times
        239: kernel launched 50000 times
            grid: [960]  block: [32x4]
            elapsed time(us): total=623,602 max=56 min=11 avg=12
    239: data region reached 100000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  free_fc  NVIDIA  devicenum=0
    time(us): 77
    261: data region reached 2 times
        261: data copyin transfers: 4
             device time(us): total=77 max=24 min=14 avg=19
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  load_conv  NVIDIA  devicenum=0
    time(us): 53
    310: update directive reached 3 times
        310: data copyin transfers: 6
             device time(us): total=53 max=20 min=3 avg=8
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  load_fc  NVIDIA  devicenum=0
    time(us): 13
    358: update directive reached 1 time
        358: data copyin transfers: 2
             device time(us): total=13 max=10 min=3 avg=6
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  make_softmax_layer  NVIDIA  devicenum=0
    time(us): 33
    384: data region reached 2 times
        384: data copyin transfers: 3
             device time(us): total=33 max=15 min=5 avg=11
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  softmax_forward  NVIDIA  devicenum=0
    time(us): 292,470
    394: compute region reached 50000 times
        394: kernel launched 50000 times
            grid: [1280]  block: [128]
            elapsed time(us): total=652,015 max=451 min=12 avg=13
        394: reduction kernel launched 50000 times
            grid: [1]  block: [256]
            elapsed time(us): total=570,209 max=358 min=10 avg=11
    394: data region reached 100000 times
        394: data copyin transfers: 100000
             device time(us): total=292,470 max=36 min=2 avg=2
    401: compute region reached 50000 times
        401: kernel launched 50000 times
            grid: [1280]  block: [128]
            elapsed time(us): total=641,810 max=1,355 min=12 avg=12
        401: reduction kernel launched 50000 times
            grid: [1]  block: [256]
            elapsed time(us): total=573,104 max=365 min=10 avg=11
    410: compute region reached 50000 times
        410: kernel launched 50000 times
            grid: [1280]  block: [128]
            elapsed time(us): total=613,001 max=59 min=11 avg=12
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/main.c
  main  NVIDIA  devicenum=0
    time(us): 150,914
    121: data region reached 1 time
        44: kernel launched 1 time
            grid: [391]  block: [128]
            elapsed time(us): total=55 max=55 min=55 avg=55
        121: data copyin transfers: 1
             device time(us): total=148,930 max=148,930 min=148,930 avg=148,930
    179: data region reached 4 times
        44: kernel launched 1 time
            grid: [391]  block: [128]
            elapsed time(us): total=27 max=27 min=27 avg=27
    246: update directive reached 1 time
        246: data copyout transfers: 1
             device time(us): total=1,984 max=1,984 min=1,984 avg=1,984
    311: data region reached 4 times
    339: data region reached 1 time
```
### nvprof
```
$ nvprof ./cnn-cifar10-profile 
Parallel (pad) Code
CNN for 50000 images
Loading input batch 1...
Loading input batch 2...
Loading input batch 3...
Loading input batch 4...
Loading input batch 5...
==2782915== NVPROF is profiling process 2782915, command: ./cnn-cifar10-profile
Load Data time:1.284649 seconds
Create Network time:0.039175 seconds
Load Network Parameters time:0.008001 seconds
Create Ouputs time:0.000328 seconds

Net Forward total time:21.014969 seconds
    Time for conv1: 3.683046 seconds
    Time for relu1: 1.111728 seconds
    Time for pool1: 1.187830 seconds
    Time for conv2: 3.340891 seconds
    Time for relu2: 1.095284 seconds
    Time for pool2: 1.060565 seconds
    Time for conv3: 2.447652 seconds
    Time for relu3: 1.078728 seconds
    Time for pool3: 0.992023 seconds
    Time for fc: 1.109159 seconds
    Time for softmax: 3.881070 seconds

  Conv: 9.471589 seconds
  ReLU: 3.285739 seconds
  Pool: 3.240418 seconds
  FC:   1.109159 seconds
  Softmax: 3.881070 seconds

Net Accuracy: 78.84 % 
Net Accuracy time:0.000739 seconds
Free memory time:0.044439 seconds
Total time:22.392300 seconds
END!
==2782915== Profiling application: ./cnn-cifar10-profile
==2782915== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   54.87%  3.81207s    150000  25.413us  11.519us  36.480us  _8layers_c_conv_forward_77_gpu
                    9.82%  681.91ms    150000  4.5460us  2.9110us  13.600us  _8layers_c_pool_forward_175_gpu
                    8.41%  584.33ms    150000  3.8950us  3.8390us  13.728us  _8layers_c_relu_forward_131_gpu
                    7.44%  516.62ms    150000  3.4440us  3.3910us  13.503us  _8layers_c_pad_input_60_gpu
                    3.28%  227.74ms     50000  4.5540us  4.4800us  13.569us  _8layers_c_softmax_forward_394_gpu
                    3.26%  226.76ms     50000  4.5350us  4.4480us  13.344us  _8layers_c_softmax_forward_401_gpu
                    2.86%  198.64ms     50000  3.9720us  3.8710us  13.376us  _8layers_c_fc_forward_239_gpu
                    2.80%  194.73ms     50000  3.8940us  3.8390us  13.504us  _8layers_c_softmax_forward_410_gpu
                    2.10%  146.00ms     50000  2.9200us  2.8790us  13.088us  _8layers_c_softmax_forward_401_gpu__red
                    2.07%  143.52ms     50000  2.8700us  2.8150us  12.896us  _8layers_c_softmax_forward_394_gpu__red
                    2.00%  138.79ms        46  3.0172ms     735ns  138.74ms  [CUDA memcpy HtoD]
                    1.09%  75.790ms    100000     757ns     735ns  1.4720us  [CUDA memset]
                    0.00%  155.55us         1  155.55us  155.55us  155.55us  [CUDA memcpy DtoH]
                    0.00%  5.5680us         2  2.7840us  2.4960us  3.0720us  _21______src_cuda_fill_c___pgi_uacc_cuda_fill_44_gpu
      API calls:   65.71%  9.07123s   1500029  6.0470us     753ns  3.0965ms  cuStreamSynchronize
                   26.46%  3.65201s    900002  4.0570us  3.1780us  6.8016ms  cuLaunchKernel
                    2.15%  296.70ms   1000000     296ns     178ns  4.8325ms  cuOccupancyMaxActiveBlocksPerMultiprocessor
                    1.89%  260.83ms    100000  2.6080us  1.8540us  775.01us  cuMemsetD32Async
                    1.15%  159.08ms         1  159.08ms  159.08ms  159.08ms  cuDevicePrimaryCtxRetain
                    1.09%  149.89ms    800011     187ns     117ns  793.40us  cuDeviceGetAttribute
                    1.01%  139.17ms        46  3.0253ms  2.6510us  138.91ms  cuMemcpyHtoDAsync
                    0.28%  38.537ms         1  38.537ms  38.537ms  38.537ms  cuMemHostAlloc
                    0.22%  30.371ms    100039     303ns     221ns  787.55us  cuPointerGetAttributes
                    0.02%  2.6804ms         1  2.6804ms  2.6804ms  2.6804ms  cuMemAllocHost
                    0.01%  1.8897ms         1  1.8897ms  1.8897ms  1.8897ms  cuMemcpyDtoHAsync
                    0.01%  1.1388ms        41  27.774us  2.0020us  407.40us  cuMemAlloc
                    0.01%  914.33us         2  457.16us  113.80us  800.53us  cuModuleLoadDataEx
                    0.00%  10.607us         1  10.607us  10.607us  10.607us  cuCtxGetCurrent
                    0.00%  9.5290us         1  9.5290us  9.5290us  9.5290us  cuDeviceGetPCIBusId
                    0.00%  7.7770us        12     648ns     283ns  1.8070us  cuModuleGetFunction
                    0.00%  3.9160us         3  1.3050us     658ns  2.1810us  cuCtxSetCurrent
                    0.00%  2.0500us         3     683ns     150ns  1.6660us  cuDeviceGetCount
                    0.00%     794ns         3     264ns     153ns     389ns  cuDriverGetVersion
                    0.00%     701ns         2     350ns     174ns     527ns  cuDeviceGet
                    0.00%     524ns         1     524ns     524ns     524ns  cuDeviceComputeCapability
 OpenACC (excl):  100.00%  1.7e+10s         1  1.7e+10s  1.7e+10s  1.7e+10s  acc_enter_data@main.c:121
                    0.00%  4.56799s    300000  15.226us  1.6300us  2.0540ms  acc_wait@layers.c:77
                    0.00%  1.42694s    300000  4.7560us  1.6270us  866.59us  acc_wait@layers.c:175
                    0.00%  1.31827s    300000  4.3940us  1.6320us  776.08us  acc_wait@layers.c:131
                    0.00%  1.27441s    300000  4.2480us  1.6580us  1.0998ms  acc_wait@layers.c:60
                    0.00%  784.37ms    150000  5.2290us  4.3900us  3.1688ms  acc_enqueue_launch@layers.c:131 (_8layers_c_relu_forward_131_gpu)
                    0.00%  778.78ms    150000  5.1910us  4.2680us  2.8612ms  acc_enqueue_launch@layers.c:175 (_8layers_c_pool_forward_175_gpu)
                    0.00%  767.41ms    150000  5.1160us  4.2790us  6.8093ms  acc_enqueue_launch@layers.c:60 (_8layers_c_pad_input_60_gpu)
                    0.00%  761.13ms    150000  5.0740us  4.1810us  1.8971ms  acc_enqueue_launch@layers.c:77 (_8layers_c_conv_forward_77_gpu)
                    0.00%  497.95ms    100000  4.9790us  2.0560us  960.10us  acc_wait@layers.c:394
                    0.00%  436.18ms    100000  4.3610us  1.6270us  752.30us  acc_wait@layers.c:239
                    0.00%  436.13ms    150000  2.9070us  2.3900us  6.7050ms  acc_compute_construct@layers.c:60
                    0.00%  427.26ms    150000  2.8480us  2.3400us  9.0778ms  acc_compute_construct@layers.c:131
                    0.00%  340.83ms     50000  6.8160us  2.0540us  117.49us  acc_wait@layers.c:410
                    0.00%  337.01ms     50000  6.7400us  2.0780us  3.1077ms  acc_wait@layers.c:401
                    0.00%  315.24ms    150000  2.1010us  1.7530us  763.69us  acc_enter_data@layers.c:131
                    0.00%  308.19ms     50000  6.1630us  5.4880us  39.435us  acc_enter_data@layers.c:394
                    0.00%  306.67ms    150000  2.0440us  1.7150us  784.67us  acc_enter_data@layers.c:175
                    0.00%  303.78ms    150000  2.0250us  1.6630us  1.3255ms  acc_enter_data@layers.c:77
                    0.00%  287.80ms     50000  5.7560us  4.7810us  2.5446ms  acc_enqueue_launch@layers.c:394 (_8layers_c_softmax_forward_394_gpu)
                    0.00%  278.64ms    150000  1.8570us  1.5100us  775.69us  acc_exit_data@layers.c:175
                    0.00%  275.27ms    150000  1.8350us  1.5470us  784.99us  acc_compute_construct@layers.c:175
                    0.00%  272.32ms    150000  1.8150us  1.5420us  1.0841ms  acc_compute_construct@layers.c:77
                    0.00%  270.04ms    150000  1.8000us  1.4960us  752.19us  acc_exit_data@layers.c:77
                    0.00%  265.59ms    150000  1.7700us  1.5500us  748.20us  acc_exit_data@layers.c:131
                    0.00%  258.82ms    150000  1.7250us  1.3760us  773.36us  acc_enter_data@layers.c:60
                    0.00%  258.35ms     50000  5.1660us  4.2460us  828.94us  acc_enqueue_launch@layers.c:239 (_8layers_c_fc_forward_239_gpu)
                    0.00%  256.23ms     50000  5.1240us  4.2320us  801.36us  acc_enqueue_launch@layers.c:394 (_8layers_c_softmax_forward_394_gpu__red)
                    0.00%  253.54ms     50000  5.0700us  4.2390us  846.57us  acc_enqueue_launch@layers.c:401 (_8layers_c_softmax_forward_401_gpu)
                    0.00%  252.65ms     50000  5.0530us  4.2360us  783.72us  acc_enqueue_launch@layers.c:410 (_8layers_c_softmax_forward_410_gpu)
                    0.00%  237.93ms     50000  4.7580us  4.1150us  25.734us  acc_enqueue_launch@layers.c:401 (_8layers_c_softmax_forward_401_gpu__red)
                    0.00%  215.38ms    150000  1.4350us  1.2340us  22.637us  acc_exit_data@layers.c:60
                    0.00%  210.25ms     50000  4.2040us  3.5360us  875.58us  acc_exit_data@layers.c:394
                    0.00%  189.42ms     50000  3.7880us  2.9460us  775.84us  acc_enqueue_upload@layers.c:394 (max)
                    0.00%  167.97ms     50000  3.3590us  2.7420us  972.69us  acc_compute_construct@layers.c:394
                    0.00%  156.83ms     50000  3.1360us  2.6100us  756.17us  acc_compute_construct@layers.c:401
                    0.00%  149.70ms     50000  2.9930us  2.5420us  741.02us  acc_enqueue_upload@layers.c:394 (total)
                    0.00%  149.36ms     50000  2.9870us  2.4150us  3.2749ms  acc_compute_construct@layers.c:239
                    0.00%  138.92ms         1  138.92ms  138.92ms  138.92ms  acc_enqueue_upload@main.c:121 (input[:50000][:3072])
                    0.00%  127.70ms     50000  2.5530us  2.2900us  20.556us  acc_compute_construct@layers.c:410
                    0.00%  105.82ms     50000  2.1160us  1.6380us  768.71us  acc_exit_data@layers.c:239
                    0.00%  101.88ms     50000  2.0370us  1.8200us  21.713us  acc_enter_data@layers.c:239
                    0.00%  38.727ms         9  4.3030ms  6.5410us  38.601ms  acc_enter_data@layers.c:42
                    0.00%  28.728ms         4  7.1819ms  16.216us  28.660ms  acc_enter_data@main.c:179
                    0.00%  1.8926ms         1  1.8926ms  1.8926ms  1.8926ms  acc_enqueue_download@main.c:246 (O11[:50000][:L11->out_size])
                    0.00%  996.93us         1  996.93us  996.93us  996.93us  acc_update@main.c:246
                    0.00%  960.83us         4  240.21us  4.2760us  940.12us  acc_exit_data@main.c:311
                    0.00%  960.49us         1  960.49us  960.49us  960.49us  acc_exit_data@main.c:339
                    0.00%  863.73us         1  863.73us  863.73us  863.73us  acc_device_init@main.c:121
                    0.00%  84.643us        18  4.7020us     838ns  30.081us  acc_enqueue_upload@layers.c:42 (.attach.)
                    0.00%  84.244us         2  42.122us  36.369us  47.875us  acc_enqueue_launch@(runtime):44 (_21______src_cuda_fill_c___pgi_uacc_cuda_fill_44_gpu)
                    0.00%  67.062us         1  67.062us  67.062us  67.062us  acc_wait@main.c:121
                    0.00%  56.744us         9  6.3040us  4.6080us  9.7080us  acc_wait@layers.c:42
                    0.00%  48.448us        18  2.6910us     819ns  9.7880us  acc_enqueue_upload@layers.c:53 (.detach.)
                    0.00%  40.679us         3  13.559us  7.3510us  18.537us  acc_enqueue_upload@layers.c:310 (l->weights[:l->weights_size])
                    0.00%  37.854us         3  12.618us  7.2950us  18.617us  acc_enqueue_upload@layers.c:42 (layer->in_padded[:layer->padded_size])
                    0.00%  37.339us         9  4.1480us  1.5220us  12.120us  acc_exit_data@layers.c:53
                    0.00%  33.490us         4  8.3720us     914ns  24.877us  acc_enqueue_upload@layers.c:261 (.detach.)
                    0.00%  25.858us         3  8.6190us  7.3570us  9.3000us  acc_enter_data@layers.c:170
                    0.00%  23.376us         3  7.7920us  3.7790us  13.303us  acc_enqueue_upload@layers.c:42 (layer[:1])
                    0.00%  22.906us         2  11.453us  7.2090us  15.697us  acc_enter_data@layers.c:234
                    0.00%  22.243us         3  7.4140us  3.8770us  9.7370us  acc_wait@layers.c:310
                    0.00%  21.779us         3  7.2590us  6.7930us  7.9590us  acc_enter_data@layers.c:126
                    0.00%  14.477us         3  4.8250us  4.7300us  4.8980us  acc_wait@layers.c:170
                    0.00%  14.400us         3  4.8000us  4.7660us  4.8310us  acc_wait@layers.c:126
                    0.00%  14.219us         2  7.1090us  1.9880us  12.231us  acc_exit_data@layers.c:261
                    0.00%  14.080us         2  7.0400us  6.6710us  7.4090us  acc_enter_data@layers.c:384
                    0.00%  13.832us         3  4.6100us  3.0890us  7.4520us  acc_update@layers.c:310
                    0.00%  11.356us         3  3.7850us  3.5500us  4.0680us  acc_enqueue_upload@layers.c:126 (layer[:1])
                    0.00%  11.271us         3  3.7570us  3.5620us  3.9810us  acc_enqueue_upload@layers.c:310 (l->bias[:l->out_depth])
                    0.00%  11.132us         3  3.7100us  3.5350us  3.9750us  acc_enqueue_upload@layers.c:170 (layer[:1])
                    0.00%  11.055us         4  2.7630us  1.4190us  5.6300us  acc_wait@main.c:179
                    0.00%  9.3610us         2  4.6800us  4.5660us  4.7950us  acc_wait@layers.c:384
                    0.00%  9.3220us         4  2.3300us     870ns  3.8330us  acc_enqueue_upload@layers.c:234 (.attach.)
                    0.00%  9.2970us         2  4.6480us  4.6270us  4.6700us  acc_wait@layers.c:234
                    0.00%  8.4540us         1  8.4540us  8.4540us  8.4540us  acc_enqueue_upload@layers.c:358 (l->weights[:l->out_depth*l->in_neurons])
                    0.00%  5.7500us         3  1.9160us  1.7580us  2.1970us  acc_exit_data@layers.c:206
                    0.00%  5.3950us         3  1.7980us  1.5080us  2.3690us  acc_exit_data@layers.c:143
                    0.00%  5.3580us         1  5.3580us  5.3580us  5.3580us  acc_wait@main.c:246
                    0.00%  5.2220us         1  5.2220us  5.2220us  5.2220us  acc_wait@layers.c:358
                    0.00%  5.0150us         2  2.5070us     882ns  4.1330us  acc_enqueue_upload@layers.c:384 (.attach.)
                    0.00%  3.6880us         1  3.6880us  3.6880us  3.6880us  acc_enqueue_upload@layers.c:384 (layer[:1])
                    0.00%  3.6660us         1  3.6660us  3.6660us  3.6660us  acc_enqueue_upload@layers.c:234 (layer[:1])
                    0.00%  3.3460us         1  3.3460us  3.3460us  3.3460us  acc_enqueue_upload@layers.c:358 (l->bias[:l->out_depth])
                    0.00%  3.0620us         1  3.0620us  3.0620us  3.0620us  acc_update@layers.c:358
                    0.00%       0ns         2       0ns       0ns       0ns  acc_alloc@main.c:121
                    0.00%       0ns         3       0ns       0ns       0ns  acc_delete@layers.c:206
                    0.00%       0ns         3       0ns       0ns       0ns  acc_alloc@layers.c:170
                    0.00%       0ns         2       0ns       0ns       0ns  acc_create@layers.c:384
                    0.00%       0ns         2       0ns       0ns       0ns  acc_delete@main.c:339
                    0.00%       0ns        12       0ns       0ns       0ns  acc_create@main.c:179
                    0.00%       0ns    100000       0ns       0ns       0ns  acc_create@layers.c:394
                    0.00%       0ns        12       0ns       0ns       0ns  acc_alloc@layers.c:42
                    0.00%       0ns        12       0ns       0ns       0ns  acc_create@layers.c:42
                    0.00%       0ns         3       0ns       0ns       0ns  acc_alloc@layers.c:234
                    0.00%       0ns         3       0ns       0ns       0ns  acc_create@layers.c:170
                    0.00%       0ns         3       0ns       0ns       0ns  acc_alloc@layers.c:126
                    0.00%       0ns         2       0ns       0ns       0ns  acc_create@main.c:121
                    0.00%       0ns        12       0ns       0ns       0ns  acc_delete@layers.c:53
                    0.00%       0ns        12       0ns       0ns       0ns  acc_alloc@main.c:179
                    0.00%       0ns    100000       0ns       0ns       0ns  acc_delete@layers.c:417
                    0.00%       0ns         2       0ns       0ns       0ns  acc_alloc@layers.c:384
                    0.00%       0ns         3       0ns       0ns       0ns  acc_create@layers.c:234
                    0.00%       0ns         3       0ns       0ns       0ns  acc_delete@layers.c:261
                    0.00%       0ns         3       0ns       0ns       0ns  acc_delete@layers.c:143
                    0.00%       0ns         2       0ns       0ns       0ns  acc_alloc@layers.c:394
                    0.00%       0ns         3       0ns       0ns       0ns  acc_create@layers.c:126
                    0.00%       0ns        12       0ns       0ns       0ns  acc_delete@main.c:311
```
# FC : vector_length(32)
## Minfo
```
fc_forward:
    239, Generating present(l[:],Y[:],X[:])
         Generating implicit firstprivate(i)
         Generating NVIDIA GPU code
        242, #pragma acc loop gang, worker(4) /* blockIdx.x threadIdx.y */
        246, #pragma acc loop vector(32) /* threadIdx.x */
             Generating reduction(+:sum)
        248, Vector barrier inserted for vector loop reduction
    246, Loop is parallelizable
    248, FMA (fused multiply-add) instruction(s) generated
```

## execution
```
$ ./cnn-cifar10 
Parallel (pad) Code
CNN for 50000 images
Loading input batch 1...
Loading input batch 2...
Loading input batch 3...
Loading input batch 4...
Loading input batch 5...
Load Data time:0.993973 seconds
Create Network time:0.040792 seconds
Load Network Parameters time:0.008495 seconds
Create Ouputs time:0.000374 seconds

Net Forward total time:12.433862 seconds
    Time for conv1: 2.498936 seconds
    Time for relu1: 0.577298 seconds
    Time for pool1: 0.679257 seconds
    Time for conv2: 2.217341 seconds
    Time for relu2: 0.578522 seconds
    Time for pool2: 0.570227 seconds
    Time for conv3: 1.440609 seconds
    Time for relu3: 0.586773 seconds
    Time for pool3: 0.511025 seconds
    Time for fc: 0.563450 seconds
    Time for softmax: 2.193389 seconds

  Conv: 6.156885 seconds
  ReLU: 1.742592 seconds
  Pool: 1.760509 seconds
  FC:   0.563450 seconds
  Softmax: 2.193389 seconds

Net Accuracy: 78.84 % 
Net Accuracy time:0.000768 seconds
Free memory time:0.043300 seconds
Total time:13.521565 seconds
```
# Softmax - vector
## code 
```
389: void softmax_forward(float* restrict X, Softmax_Layer* l, float* restrict Y) {
  
  float max = -INFINITY;
  float total = 0.0f;
  #pragma acc data copyin(max,total) present(X,l,Y)
  {
    // Compute max activation
  #pragma acc parallel loop reduction(max:max) vector vector_length(10)
  for (int i = 0; i < l->out_depth; i++) {
    if (X[i] > max) {
      max = X[i];
    }
  }

  // Compute exponentials and total
  
#pragma acc parallel loop reduction(+:total) vector vector_length(10)
  for (int i = 0; i < l->out_depth; i++) {
    float e = exp(X[i] - max);
    total += e;
    l->likelihoods[i] = e;
  }

  // Normalize and output to sum to one
#pragma acc parallel loop vector vector_length(10) 
  for (int i = 0; i < l->out_depth; i++) {
    Y[i] = l->likelihoods[i] / total;
  }
  } // acc data
}
```
## Minfo
```
softmax_forward:
    394, Generating copyin(max,total) [if not already present]
         Generating present(l[:],Y[:],X[:])
         Generating implicit firstprivate(i)
         Generating NVIDIA GPU code
        397, #pragma acc loop vector(10) /* threadIdx.x */
             Generating reduction(max:max)
    397, Loop is parallelizable
    401, Generating implicit firstprivate(i)
         Generating NVIDIA GPU code
        406, #pragma acc loop vector(10) /* threadIdx.x */
             Generating reduction(+:total)
    406, Loop is parallelizable
    410, Generating implicit firstprivate(i)
         Generating NVIDIA GPU code
        414, #pragma acc loop vector(10) /* threadIdx.x */
    414, Loop is parallelizable
```

## execution
```
$ ./cnn-cifar10 
Parallel (pad) Code
CNN for 50000 images
Loading input batch 1...
Loading input batch 2...
Loading input batch 3...
Loading input batch 4...
Loading input batch 5...
Load Data time:1.020619 seconds
Create Network time:0.040197 seconds
Load Network Parameters time:0.008093 seconds
Create Ouputs time:0.000368 seconds

Net Forward total time:12.013798 seconds
    Time for conv1: 2.525248 seconds
    Time for relu1: 0.589349 seconds
    Time for pool1: 0.695155 seconds
    Time for conv2: 2.238118 seconds
    Time for relu2: 0.594293 seconds
    Time for pool2: 0.588106 seconds
    Time for conv3: 1.464922 seconds
    Time for relu3: 0.598221 seconds
    Time for pool3: 0.527708 seconds
    Time for fc: 0.577557 seconds
    Time for softmax: 1.598220 seconds

  Conv: 6.228289 seconds
  ReLU: 1.781863 seconds
  Pool: 1.810969 seconds
  FC:   0.577557 seconds
  Softmax: 1.598220 seconds

Net Accuracy: 78.84 % 
Net Accuracy time:0.000729 seconds
Free memory time:0.041771 seconds
Total time:13.125576 seconds
```

## Profiling
### NV_ACC
```
$ ./cnn-cifar10 
Parallel (pad) Code
CNN for 50000 images
Loading input batch 1...
Loading input batch 2...
Loading input batch 3...
Loading input batch 4...
Loading input batch 5...
CUPTI ERROR: cuptiActivityEnable(CUPTI_ACTIVITY_KIND_KERNEL) returned: CUPTI_ERROR_INSUFFICIENT_PRIVILEGES, 
         at ../../src-cupti/prof_cuda_cupti.c:338.
Load Data time:1.158339 seconds
Create Network time:0.040563 seconds
Load Network Parameters time:0.008847 seconds
Create Ouputs time:0.000339 seconds

Net Forward total time:16.379307 seconds
    Time for conv1: 2.984038 seconds
    Time for relu1: 0.818645 seconds
    Time for pool1: 0.925026 seconds
    Time for conv2: 2.699860 seconds
    Time for relu2: 0.812763 seconds
    Time for pool2: 0.811360 seconds
    Time for conv3: 1.925949 seconds
    Time for relu3: 0.822527 seconds
    Time for pool3: 0.760033 seconds
    Time for fc: 0.809660 seconds
    Time for softmax: 2.992502 seconds

  Conv: 7.609847 seconds
  ReLU: 2.453934 seconds
  Pool: 2.496418 seconds
  FC:   0.809660 seconds
  Softmax: 2.992502 seconds

Net Accuracy: 78.84 % 
Net Accuracy time:0.000766 seconds
Free memory time:0.044701 seconds
Total time:17.632861 seconds
END!

Accelerator Kernel Timing data
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  make_conv_layer  NVIDIA  devicenum=0
    time(us): 268
    42: data region reached 9 times
        42: data copyin transfers: 24
             device time(us): total=268 max=47 min=3 avg=11
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  free_conv  NVIDIA  devicenum=0
    time(us): 126
    53: data region reached 9 times
        53: data copyin transfers: 18
             device time(us): total=126 max=12 min=3 avg=7
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  pad_input  NVIDIA  devicenum=0
    time(us): 0
    60: compute region reached 150000 times
        60: kernel launched 150000 times
            grid: [800]  block: [32x4]
            elapsed time(us): total=1,803,338 max=383 min=11 avg=12
    60: data region reached 300000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  conv_forward  NVIDIA  devicenum=0
    time(us): 0
    77: compute region reached 150000 times
        77: kernel launched 150000 times
            grid: [160-512]  block: [32x4]
            elapsed time(us): total=4,750,055 max=405 min=18 avg=31
    77: data region reached 300000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  make_relu_layer  NVIDIA  devicenum=0
    time(us): 11
    126: data region reached 3 times
        126: data copyin transfers: 3
             device time(us): total=11 max=4 min=3 avg=3
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  relu_forward  NVIDIA  devicenum=0
    time(us): 0
    131: compute region reached 150000 times
        131: kernel launched 150000 times
            grid: [1280]  block: [32x4]
            elapsed time(us): total=1,869,649 max=311 min=11 avg=12
    131: data region reached 300000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  free_relu  NVIDIA  devicenum=0
    time(us): 0
    143: data region reached 3 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  make_pool_layer  NVIDIA  devicenum=0
    time(us): 9
    170: data region reached 3 times
        170: data copyin transfers: 3
             device time(us): total=9 max=3 min=3 avg=3
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  pool_forward  NVIDIA  devicenum=0
    time(us): 0
    175: compute region reached 150000 times
        175: kernel launched 150000 times
            grid: [80-256]  block: [32x4]
            elapsed time(us): total=1,950,857 max=1,342 min=11 avg=13
    175: data region reached 300000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  free_pool  NVIDIA  devicenum=0
    time(us): 0
    206: data region reached 3 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  make_fc_layer  NVIDIA  devicenum=0
    time(us): 34
    234: data region reached 2 times
        234: data copyin transfers: 5
             device time(us): total=34 max=12 min=3 avg=6
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  fc_forward  NVIDIA  devicenum=0
    time(us): 0
    239: compute region reached 50000 times
        239: kernel launched 50000 times
            grid: [960]  block: [32x4]
            elapsed time(us): total=611,888 max=38 min=11 avg=12
    239: data region reached 100000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  free_fc  NVIDIA  devicenum=0
    time(us): 80
    261: data region reached 2 times
        261: data copyin transfers: 4
             device time(us): total=80 max=26 min=15 avg=20
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  load_conv  NVIDIA  devicenum=0
    time(us): 58
    310: update directive reached 3 times
        310: data copyin transfers: 6
             device time(us): total=58 max=22 min=3 avg=9
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  load_fc  NVIDIA  devicenum=0
    time(us): 12
    358: update directive reached 1 time
        358: data copyin transfers: 2
             device time(us): total=12 max=9 min=3 avg=6
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  make_softmax_layer  NVIDIA  devicenum=0
    time(us): 19
    384: data region reached 2 times
        384: data copyin transfers: 3
             device time(us): total=19 max=11 min=4 avg=6
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/layers.c
  softmax_forward  NVIDIA  devicenum=0
    time(us): 290,487
    394: compute region reached 50000 times
        394: kernel launched 50000 times
            grid: [1]  block: [10]
            elapsed time(us): total=560,938 max=440 min=10 avg=11
    394: data region reached 100000 times
        394: data copyin transfers: 100000
             device time(us): total=290,487 max=20 min=2 avg=2
    401: compute region reached 50000 times
        401: kernel launched 50000 times
            grid: [1]  block: [10]
            elapsed time(us): total=561,079 max=45 min=10 avg=11
    410: compute region reached 50000 times
        410: kernel launched 50000 times
            grid: [1]  block: [10]
            elapsed time(us): total=525,975 max=310 min=10 avg=10
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-3.1-conv-pool/main.c
  main  NVIDIA  devicenum=0
    time(us): 156,935
    121: data region reached 1 time
        44: kernel launched 1 time
            grid: [391]  block: [128]
            elapsed time(us): total=46 max=46 min=46 avg=46
        121: data copyin transfers: 1
             device time(us): total=154,981 max=154,981 min=154,981 avg=154,981
    179: data region reached 4 times
        44: kernel launched 1 time
            grid: [391]  block: [128]
            elapsed time(us): total=30 max=30 min=30 avg=30
    246: update directive reached 1 time
        246: data copyout transfers: 1
             device time(us): total=1,954 max=1,954 min=1,954 avg=1,954
    311: data region reached 4 times
    339: data region reached 1 time
```

### nvprof

```
$ nvprof ./cnn-cifar10-profile 
Parallel (pad) Code
CNN for 50000 images
Loading input batch 1...
Loading input batch 2...
Loading input batch 3...
Loading input batch 4...
Loading input batch 5...
==2817187== NVPROF is profiling process 2817187, command: ./cnn-cifar10-profile
Load Data time:1.339263 seconds
Create Network time:0.038290 seconds
Load Network Parameters time:0.008332 seconds
Create Ouputs time:0.000312 seconds

Net Forward total time:20.337517 seconds
    Time for conv1: 3.713703 seconds
    Time for relu1: 1.100608 seconds
    Time for pool1: 1.201944 seconds
    Time for conv2: 3.359318 seconds
    Time for relu2: 1.100214 seconds
    Time for pool2: 1.084800 seconds
    Time for conv3: 2.460114 seconds
    Time for relu3: 1.113514 seconds
    Time for pool3: 0.995849 seconds
    Time for fc: 1.116770 seconds
    Time for softmax: 3.064460 seconds

  Conv: 9.533135 seconds
  ReLU: 3.314336 seconds
  Pool: 3.282593 seconds
  FC:   1.116770 seconds
  Softmax: 3.064460 seconds

Net Accuracy: 78.84 % 
Net Accuracy time:0.000735 seconds
Free memory time:0.044852 seconds
Total time:21.769301 seconds
END!
==2817187== Profiling application: ./cnn-cifar10-profile
==2817187== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   59.87%  3.81207s    150000  25.413us  11.488us  36.384us  _8layers_c_conv_forward_77_gpu
                   10.70%  681.45ms    150000  4.5430us  2.9110us  13.568us  _8layers_c_pool_forward_175_gpu
                    9.17%  583.86ms    150000  3.8920us  3.8390us  13.568us  _8layers_c_relu_forward_131_gpu
                    8.13%  517.94ms    150000  3.4520us  3.3910us  13.537us  _8layers_c_pad_input_60_gpu
                    2.94%  187.33ms     50000  3.7460us  3.6480us  13.536us  _8layers_c_fc_forward_239_gpu
                    2.22%  141.53ms     50000  2.8300us  2.7830us  13.536us  _8layers_c_softmax_forward_401_gpu
                    2.15%  136.85ms        46  2.9749ms     735ns  136.79ms  [CUDA memcpy HtoD]
                    1.99%  126.95ms     50000  2.5390us  2.4950us  13.567us  _8layers_c_softmax_forward_394_gpu
                    1.62%  103.27ms     50000  2.0650us  2.0150us  13.503us  _8layers_c_softmax_forward_410_gpu
                    1.19%  75.777ms    100000     757ns     735ns  1.1840us  [CUDA memset]
                    0.00%  155.71us         1  155.71us  155.71us  155.71us  [CUDA memcpy DtoH]
                    0.00%  5.3130us         2  2.6560us  2.5290us  2.7840us  _21______src_cuda_fill_c___pgi_uacc_cuda_fill_44_gpu
      API calls:   67.80%  9.02032s   1500029  6.0130us     785ns  3.7348ms  cuStreamSynchronize
                   25.15%  3.34644s    800002  4.1830us  3.3760us  6.6226ms  cuLaunchKernel
                    1.88%  249.97ms    100000  2.4990us  1.8980us  2.6608ms  cuMemsetD32Async
                    1.53%  203.93ms    700000     291ns     185ns  5.1506ms  cuOccupancyMaxActiveBlocksPerMultiprocessor
                    1.04%  138.08ms         1  138.08ms  138.08ms  138.08ms  cuDevicePrimaryCtxRetain
                    1.03%  137.21ms        46  2.9828ms  2.6020us  136.97ms  cuMemcpyHtoDAsync
                    0.94%  125.14ms    800011     156ns     128ns  762.41us  cuDeviceGetAttribute
                    0.28%  37.632ms         1  37.632ms  37.632ms  37.632ms  cuMemHostAlloc
                    0.28%  36.916ms    100039     369ns     236ns  940.21us  cuPointerGetAttributes
                    0.03%  4.4544ms        40  111.36us  1.7660us  2.5168ms  cuMemAlloc
                    0.01%  1.8564ms         1  1.8564ms  1.8564ms  1.8564ms  cuMemcpyDtoHAsync
                    0.01%  1.3356ms         1  1.3356ms  1.3356ms  1.3356ms  cuMemAllocHost
                    0.01%  1.1362ms         2  568.08us  115.41us  1.0208ms  cuModuleLoadDataEx
                    0.00%  10.514us         1  10.514us  10.514us  10.514us  cuDeviceGetPCIBusId
                    0.00%  9.7050us         1  9.7050us  9.7050us  9.7050us  cuCtxGetCurrent
                    0.00%  7.0570us        10     705ns     325ns  2.1040us  cuModuleGetFunction
                    0.00%  3.6000us         3  1.2000us     191ns  1.8360us  cuCtxSetCurrent
                    0.00%  1.6800us         3     560ns     230ns  1.0740us  cuDeviceGetCount
                    0.00%     924ns         3     308ns     163ns     481ns  cuDriverGetVersion
                    0.00%     819ns         2     409ns     215ns     604ns  cuDeviceGet
                    0.00%     585ns         1     585ns     585ns     585ns  cuDeviceComputeCapability
 OpenACC (excl):  100.00%  1.7e+10s         1  1.7e+10s  1.7e+10s  1.7e+10s  acc_enter_data@main.c:121
                    0.00%  4.59402s    300000  15.313us  1.6240us  2.0253ms  acc_wait@layers.c:77
                    0.00%  1.47361s    300000  4.9120us  1.6520us  835.07us  acc_wait@layers.c:175
                    0.00%  1.30770s    300000  4.3590us  1.6570us  744.67us  acc_wait@layers.c:131
                    0.00%  1.24297s    300000  4.1430us  1.6650us  2.3783ms  acc_wait@layers.c:60
                    0.00%  822.80ms    150000  5.4850us  4.4650us  6.6309ms  acc_enqueue_launch@layers.c:60 (_8layers_c_pad_input_60_gpu)
                    0.00%  809.45ms    150000  5.3960us  4.4890us  904.93us  acc_enqueue_launch@layers.c:131 (_8layers_c_relu_forward_131_gpu)
                    0.00%  781.51ms    150000  5.2100us  4.4490us  2.7078ms  acc_enqueue_launch@layers.c:175 (_8layers_c_pool_forward_175_gpu)
                    0.00%  776.44ms    150000  5.1760us  4.4210us  3.5830ms  acc_enqueue_launch@layers.c:77 (_8layers_c_conv_forward_77_gpu)
                    0.00%  477.76ms    100000  4.7770us  1.6420us  3.7365ms  acc_wait@layers.c:239
                    0.00%  455.85ms    100000  4.5580us  2.0450us  23.464us  acc_wait@layers.c:394
                    0.00%  429.94ms    150000  2.8660us  2.4120us  5.8873ms  acc_compute_construct@layers.c:60
                    0.00%  429.54ms    150000  2.8630us  2.3800us  8.5537ms  acc_compute_construct@layers.c:131
                    0.00%  345.23ms    150000  2.3010us  1.7430us  1.2607ms  acc_enter_data@layers.c:77
                    0.00%  335.11ms     50000  6.7020us  5.6000us  1.2007ms  acc_enter_data@layers.c:394
                    0.00%  332.70ms    150000  2.2180us  1.7860us  1.5450ms  acc_enter_data@layers.c:175
                    0.00%  331.05ms    150000  2.2070us  1.8300us  2.5641ms  acc_enter_data@layers.c:131
                    0.00%  312.44ms     50000  6.2480us  2.0570us  818.18us  acc_wait@layers.c:401
                    0.00%  297.13ms     50000  5.9420us  4.8570us  825.26us  acc_enqueue_launch@layers.c:394 (_8layers_c_softmax_forward_394_gpu)
                    0.00%  272.37ms     50000  5.4470us  2.0030us  804.67us  acc_wait@layers.c:410
                    0.00%  263.87ms    150000  1.7590us  1.5510us  756.25us  acc_exit_data@layers.c:131
                    0.00%  260.80ms    150000  1.7380us  1.5120us  736.51us  acc_exit_data@layers.c:175
                    0.00%  260.60ms    150000  1.7370us  1.5710us  747.82us  acc_compute_construct@layers.c:175
                    0.00%  258.65ms    150000  1.7240us  1.5490us  21.839us  acc_compute_construct@layers.c:77
                    0.00%  253.78ms    150000  1.6910us  1.4770us  400.40us  acc_exit_data@layers.c:77
                    0.00%  253.47ms    150000  1.6890us  1.4500us  729.35us  acc_enter_data@layers.c:60
                    0.00%  249.53ms     50000  4.9900us  4.4570us  811.23us  acc_enqueue_launch@layers.c:239 (_8layers_c_fc_forward_239_gpu)
                    0.00%  249.42ms     50000  4.9880us  4.4350us  733.03us  acc_enqueue_launch@layers.c:401 (_8layers_c_softmax_forward_401_gpu)
                    0.00%  248.53ms     50000  4.9700us  4.3190us  2.5393ms  acc_enqueue_launch@layers.c:410 (_8layers_c_softmax_forward_410_gpu)
                    0.00%  218.00ms    150000  1.4530us  1.2110us  2.8625ms  acc_exit_data@layers.c:60
                    0.00%  196.67ms     50000  3.9330us  3.5220us  55.726us  acc_exit_data@layers.c:394
                    0.00%  180.23ms     50000  3.6040us  2.9420us  2.6624ms  acc_enqueue_upload@layers.c:394 (max)
                    0.00%  149.31ms     50000  2.9860us  2.5790us  26.914us  acc_enqueue_upload@layers.c:394 (total)
                    0.00%  136.97ms         1  136.97ms  136.97ms  136.97ms  acc_enqueue_upload@main.c:121 (input[:50000][:3072])
                    0.00%  134.90ms     50000  2.6970us  2.4510us  48.098us  acc_compute_construct@layers.c:239
                    0.00%  105.21ms     50000  2.1040us  1.8960us  97.966us  acc_enter_data@layers.c:239
                    0.00%  91.884ms     50000  1.8370us  1.6200us  764.54us  acc_compute_construct@layers.c:394
                    0.00%  90.435ms     50000  1.8080us  1.6290us  18.859us  acc_exit_data@layers.c:239
                    0.00%  85.042ms     50000  1.7000us  1.5170us  21.100us  acc_compute_construct@layers.c:401
                    0.00%  85.025ms     50000  1.7000us  1.5220us  18.524us  acc_compute_construct@layers.c:410
                    0.00%  37.822ms         9  4.2024ms  7.6230us  37.680ms  acc_enter_data@layers.c:42
                    0.00%  30.437ms         4  7.6092ms  19.246us  30.368ms  acc_enter_data@main.c:179
                    0.00%  1.8597ms         1  1.8597ms  1.8597ms  1.8597ms  acc_enqueue_download@main.c:246 (O11[:50000][:L11->out_size])
                    0.00%  1.1250ms         1  1.1250ms  1.1250ms  1.1250ms  acc_device_init@main.c:121
                    0.00%  1.0910ms         4  272.76us  5.2480us  1.0519ms  acc_exit_data@main.c:311
                    0.00%  1.0668ms         1  1.0668ms  1.0668ms  1.0668ms  acc_update@main.c:246
                    0.00%  989.23us         1  989.23us  989.23us  989.23us  acc_exit_data@main.c:339
                    0.00%  84.448us         2  42.224us  37.336us  47.112us  acc_enqueue_launch@(runtime):44 (_21______src_cuda_fill_c___pgi_uacc_cuda_fill_44_gpu)
                    0.00%  82.976us        18  4.6090us     894ns  26.934us  acc_enqueue_upload@layers.c:42 (.attach.)
                    0.00%  70.857us         1  70.857us  70.857us  70.857us  acc_wait@main.c:121
                    0.00%  56.430us         9  6.2700us  4.5800us  9.3530us  acc_wait@layers.c:42
                    0.00%  42.446us        18  2.3580us     816ns  5.8740us  acc_enqueue_upload@layers.c:53 (.detach.)
                    0.00%  40.317us         3  13.439us  7.0940us  18.546us  acc_enqueue_upload@layers.c:310 (l->weights[:l->weights_size])
                    0.00%  31.046us         3  10.348us  7.4910us  12.040us  acc_enqueue_upload@layers.c:42 (layer->in_padded[:layer->padded_size])
                    0.00%  30.221us         4  7.5550us     933ns  22.446us  acc_enqueue_upload@layers.c:261 (.detach.)
                    0.00%  27.538us         3  9.1790us  7.4640us  10.111us  acc_enter_data@layers.c:126
                    0.00%  25.239us         9  2.8040us  1.5170us  4.5650us  acc_exit_data@layers.c:53
                    0.00%  23.765us         2  11.882us  7.6340us  16.131us  acc_enter_data@layers.c:234
                    0.00%  22.320us         3  7.4400us  3.7770us  9.5890us  acc_wait@layers.c:310
                    0.00%  21.525us         3  7.1750us  3.9330us  13.502us  acc_enqueue_upload@layers.c:42 (layer[:1])
                    0.00%  20.938us         3  6.9790us  6.6990us  7.4280us  acc_enter_data@layers.c:170
                    0.00%  14.660us         3  4.8860us  2.9350us  8.3740us  acc_update@layers.c:310
                    0.00%  14.518us         3  4.8390us  4.7440us  5.0220us  acc_wait@layers.c:170
                    0.00%  14.218us         3  4.7390us  4.6570us  4.8420us  acc_wait@layers.c:126
                    0.00%  14.159us         2  7.0790us  7.0490us  7.1100us  acc_enter_data@layers.c:384
                    0.00%  14.025us         2  7.0120us  1.8850us  12.140us  acc_exit_data@layers.c:261
                    0.00%  12.267us         3  4.0890us  3.9120us  4.2080us  acc_enqueue_upload@layers.c:126 (layer[:1])
                    0.00%  11.353us         3  3.7840us  3.4120us  4.2800us  acc_enqueue_upload@layers.c:310 (l->bias[:l->out_depth])
                    0.00%  11.306us         3  3.7680us  3.7370us  3.8120us  acc_enqueue_upload@layers.c:170 (layer[:1])
                    0.00%  10.430us         4  2.6070us  1.4440us  5.2140us  acc_wait@main.c:179
                    0.00%  9.9230us         4  2.4800us     887ns  4.0970us  acc_enqueue_upload@layers.c:234 (.attach.)
                    0.00%  9.8370us         1  9.8370us  9.8370us  9.8370us  acc_enqueue_upload@layers.c:358 (l->weights[:l->out_depth*l->in_neurons])
                    0.00%  9.4120us         2  4.7060us  4.5910us  4.8210us  acc_wait@layers.c:234
                    0.00%  9.3890us         2  4.6940us  4.5740us  4.8150us  acc_wait@layers.c:384
                    0.00%  5.5950us         3  1.8650us  1.6060us  2.2110us  acc_exit_data@layers.c:206
                    0.00%  5.3160us         2  2.6580us     951ns  4.3650us  acc_enqueue_upload@layers.c:384 (.attach.)
                    0.00%  5.1830us         3  1.7270us  1.5610us  1.9850us  acc_exit_data@layers.c:143
                    0.00%  4.8490us         1  4.8490us  4.8490us  4.8490us  acc_wait@main.c:246
                    0.00%  4.8020us         1  4.8020us  4.8020us  4.8020us  acc_wait@layers.c:358
                    0.00%  3.8380us         1  3.8380us  3.8380us  3.8380us  acc_enqueue_upload@layers.c:234 (layer[:1])
                    0.00%  3.8270us         1  3.8270us  3.8270us  3.8270us  acc_enqueue_upload@layers.c:384 (layer[:1])
                    0.00%  3.5010us         1  3.5010us  3.5010us  3.5010us  acc_enqueue_upload@layers.c:358 (l->bias[:l->out_depth])
                    0.00%  3.3700us         1  3.3700us  3.3700us  3.3700us  acc_update@layers.c:358
                    0.00%       0ns         2       0ns       0ns       0ns  acc_alloc@main.c:121
                    0.00%       0ns         3       0ns       0ns       0ns  acc_delete@layers.c:206
                    0.00%       0ns         3       0ns       0ns       0ns  acc_alloc@layers.c:170
                    0.00%       0ns         2       0ns       0ns       0ns  acc_create@layers.c:384
                    0.00%       0ns         2       0ns       0ns       0ns  acc_delete@main.c:339
                    0.00%       0ns        12       0ns       0ns       0ns  acc_create@main.c:179
                    0.00%       0ns    100000       0ns       0ns       0ns  acc_create@layers.c:394
                    0.00%       0ns        12       0ns       0ns       0ns  acc_alloc@layers.c:42
                    0.00%       0ns        12       0ns       0ns       0ns  acc_create@layers.c:42
                    0.00%       0ns         3       0ns       0ns       0ns  acc_alloc@layers.c:234
                    0.00%       0ns         3       0ns       0ns       0ns  acc_create@layers.c:170
                    0.00%       0ns         3       0ns       0ns       0ns  acc_alloc@layers.c:126
                    0.00%       0ns         2       0ns       0ns       0ns  acc_create@main.c:121
                    0.00%       0ns        12       0ns       0ns       0ns  acc_delete@layers.c:53
                    0.00%       0ns        12       0ns       0ns       0ns  acc_alloc@main.c:179
                    0.00%       0ns    100000       0ns       0ns       0ns  acc_delete@layers.c:417
                    0.00%       0ns         2       0ns       0ns       0ns  acc_alloc@layers.c:384
                    0.00%       0ns         3       0ns       0ns       0ns  acc_create@layers.c:234
                    0.00%       0ns         3       0ns       0ns       0ns  acc_delete@layers.c:261
                    0.00%       0ns         3       0ns       0ns       0ns  acc_delete@layers.c:143
                    0.00%       0ns         2       0ns       0ns       0ns  acc_alloc@layers.c:394
                    0.00%       0ns         3       0ns       0ns       0ns  acc_create@layers.c:126
                    0.00%       0ns        12       0ns       0ns       0ns  acc_delete@main.c:311
```
