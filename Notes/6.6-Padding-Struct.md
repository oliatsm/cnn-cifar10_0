# Improving serial code with padding

## Padding on Conv Struct

#### 1200 images
```
$ ./cnn-cifar10-serial 
Serial Code
CNN for 1200 images
Loading input batch 1...
Load Data time:0.027480 seconds
Create Network time:0.000069 seconds
Load Network Parameters time:0.008305 seconds
Create Ouputs time:0.000055 seconds

Net Forward total time:23.127095 seconds
    Time for conv1: 7.182014 seconds
    Time for relu1: 0.109774 seconds
    Time for pool1: 0.153704 seconds
    Time for conv2: 11.878434 seconds
    Time for relu2: 0.030893 seconds
    Time for pool2: 0.045888 seconds
    Time for conv3: 3.690932 seconds
    Time for relu3: 0.008189 seconds
    Time for pool3: 0.012544 seconds
    Time for fc: 0.013559 seconds
    Time for softmax: 0.000582 seconds

  Conv: 22.751379 seconds
  ReLU: 0.148856 seconds
  Pool: 0.212136 seconds
  FC:   0.013559 seconds
  Softmax: 0.000582 seconds

Net Accuracy: 78.25 % 
Net Accuracy time:0.000102 seconds
Free memory time:0.001775 seconds
Total time:23.164882 seconds
END!
```
#### 50k images

```
$ ./cnn-cifar10-serial 
Serial Code
CNN for 50000 images
Loading input batch 1...
Loading input batch 2...
Loading input batch 3...
Loading input batch 4...
Loading input batch 5...
Load Data time:0.974951 seconds
Create Network time:0.000070 seconds
Load Network Parameters time:0.008447 seconds
Create Ouputs time:0.000443 seconds

Net Forward total time:923.071477 seconds
    Time for conv1: 286.312681 seconds
    Time for relu1: 4.397399 seconds
    Time for pool1: 6.151344 seconds
    Time for conv2: 473.989921 seconds
    Time for relu2: 1.234319 seconds
    Time for pool2: 1.841110 seconds
    Time for conv3: 147.732905 seconds
    Time for relu3: 0.322829 seconds
    Time for pool3: 0.499408 seconds
    Time for fc: 0.544242 seconds
    Time for softmax: 0.022354 seconds

  Conv: 908.035507 seconds
  ReLU: 5.954547 seconds
  Pool: 8.491862 seconds
  FC:   0.544242 seconds
  Softmax: 0.022354 seconds

Net Accuracy: 78.84 % 
Net Accuracy time:0.004081 seconds
Free memory time:0.060855 seconds
Total time:924.120324 seconds
END!
```

## Parallel with Pad-struct

pad_input -> Parallel

```
$ make
nvc -acc -Minfo=all -c11 -Wall -Wextra -march=native -gpu=managed -c main.c -o main.o
arr2txt:
    332, Zero trip check eliminated
arr2txt_2:
    354, Zero trip check eliminated
nvc -acc -Minfo=all -c11 -Wall -Wextra -march=native -gpu=managed -c layers.c -o layers.o
pad_input:
     60, Generating implicit firstprivate(c)
         Generating NVIDIA GPU code
         63, #pragma acc loop gang /* blockIdx.x */
         65, #pragma acc loop seq
         67, #pragma acc loop vector(128) /* threadIdx.x */
     60, Generating implicit copyin(X[:]) [if not already present]
         Generating implicit copy(l) [if not already present]
     65, Loop is parallelizable
     67, Loop is parallelizable
conv_forward:
     80, Generating implicit firstprivate(m)
         Generating NVIDIA GPU code
         84, #pragma acc loop gang /* blockIdx.x */
         86, #pragma acc loop seq
         88, #pragma acc loop seq
         93, #pragma acc loop seq
         94, #pragma acc loop seq
         95, #pragma acc loop vector(128) /* threadIdx.x */
             Generating reduction(+:sum)
     80, Generating implicit copy(Y[:]) [if not already present]
         Generating implicit copyin(l) [if not already present]
     86, Loop is parallelizable
     88, Loop is parallelizable
     93, Loop is parallelizable
     94, Loop is parallelizable
     95, Loop is parallelizable
    100, FMA (fused multiply-add) instruction(s) generated
pool_forward:
    183, Zero trip check eliminated
fc_forward:
    238, FMA (fused multiply-add) instruction(s) generated
nvc -acc -Minfo=all -c11 -Wall -Wextra -march=native -gpu=managed -c malloc2D.c -o malloc2D.o
nvc -acc -Minfo=all -c11 -Wall -Wextra -march=native -gpu=managed -c timer.c -o timer.o
cpu_timer_stop:
     11, FMA (fused multiply-add) instruction(s) generated
nvc -acc -Minfo=all -c11 -Wall -Wextra -march=native -gpu=managed -o cnn-cifar10 main.o layers.o malloc2D.o timer.o
olia@krylov100:~/Diplomatiki/cnn-cifar10_0/serial2parallel-pad$ ./cnn-cifar10 
Parallel (pad) Code
CNN for 1200 images
Loading input batch 1...
Load Data time:0.013170 seconds
Create Network time:0.000736 seconds
Load Network Parameters time:0.008616 seconds
Create Ouputs time:0.000039 seconds

Net Forward total time:5.583437 seconds
    Time for conv1: 2.423479 seconds
    Time for relu1: 0.090080 seconds
    Time for pool1: 0.075770 seconds
    Time for conv2: 1.836205 seconds
    Time for relu2: 0.072588 seconds
    Time for pool2: 0.067707 seconds
    Time for conv3: 0.824653 seconds
    Time for relu3: 0.060623 seconds
    Time for pool3: 0.026688 seconds
    Time for fc: 0.104544 seconds
    Time for softmax: 0.000635 seconds

  Conv: 5.084337 seconds
  ReLU: 0.223291 seconds
  Pool: 0.170165 seconds
  FC:   0.104544 seconds
  Softmax: 0.000635 seconds

Net Accuracy: 78.25 % 
Net Accuracy time:0.000023 seconds
Free memory time:0.000075 seconds
Total time:5.606095 seconds
END!

$ nvprof ./cnn-cifar10-profile 
Parallel (pad) Code
CNN for 1200 images
==1668494== NVPROF is profiling process 1668494, command: ./cnn-cifar10-profile
Loading input batch 1...
Load Data time:0.026003 seconds
Create Network time:0.001077 seconds
Load Network Parameters time:0.009128 seconds
Create Ouputs time:0.000128 seconds

Net Forward total time:6.284660 seconds
    Time for conv1: 2.489260 seconds
    Time for relu1: 0.175896 seconds
    Time for pool1: 0.092586 seconds
    Time for conv2: 1.872586 seconds
    Time for relu2: 0.174134 seconds
    Time for pool2: 0.144162 seconds
    Time for conv3: 0.863933 seconds
    Time for relu3: 0.167714 seconds
    Time for pool3: 0.062198 seconds
    Time for fc: 0.240878 seconds
    Time for softmax: 0.000734 seconds

  Conv: 5.225779 seconds
  ReLU: 0.517745 seconds
  Pool: 0.298946 seconds
  FC:   0.240878 seconds
  Softmax: 0.000734 seconds

Net Accuracy: 78.25 % 
Net Accuracy time:0.000033 seconds
Free memory time:0.000092 seconds
Total time:6.321122 seconds
END!
==1668494== Profiling application: ./cnn-cifar10-profile
==1668494== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   80.19%  4.03290s      3600  1.1202ms  333.34us  3.6756ms  _8layers_c_conv_forward_80_gpu
                   19.80%  995.89ms      3600  276.64us  57.599us  783.39us  _8layers_c_pad_input_60_gpu
                    0.01%  488.19us         3  162.73us  1.6950us  329.15us  [CUDA memset]
      API calls:   95.24%  5.06005s     14400  351.39us  1.0080us  3.6737ms  cuStreamSynchronize
                    3.14%  166.64ms         1  166.64ms  166.64ms  166.64ms  cuDevicePrimaryCtxRetain
                    0.93%  49.453ms      7200  6.8680us  3.5520us  797.48us  cuLaunchKernel
                    0.39%  20.615ms         1  20.615ms  20.615ms  20.615ms  cuMemAllocManaged
                    0.12%  6.1535ms     14400     427ns     187ns  18.283us  cuOccupancyMaxActiveBlocksPerMultiprocessor
                    0.11%  5.8307ms         1  5.8307ms  5.8307ms  5.8307ms  cuMemAllocHost
                    0.04%  2.0469ms      7209     283ns     119ns  13.588us  cuDeviceGetAttribute
                    0.02%  1.2147ms      1208  1.0050us     357ns  28.699us  cuPointerGetAttributes
                    0.01%  574.96us         3  191.65us  9.7470us  386.65us  cuMemsetD8
                    0.01%  425.80us         1  425.80us  425.80us  425.80us  cuModuleLoadDataEx
                    0.00%  134.90us         1  134.90us  134.90us  134.90us  cuMemAlloc
                    0.00%  15.159us         2  7.5790us     651ns  14.508us  cuModuleGetFunction
                    0.00%  9.2260us         1  9.2260us  9.2260us  9.2260us  cuDeviceGetPCIBusId
                    0.00%  2.7500us         3     916ns     224ns  1.5940us  cuCtxSetCurrent
                    0.00%  1.4020us         3     467ns     137ns  1.0780us  cuDeviceGetCount
                    0.00%  1.3510us         2     675ns     393ns     958ns  cuDeviceTotalMem
                    0.00%     825ns         3     275ns     131ns     487ns  cuDriverGetVersion
                    0.00%     546ns         2     273ns     123ns     423ns  cuDeviceGet
                    0.00%     413ns         1     413ns     413ns     413ns  cuCtxGetCurrent
                    0.00%     289ns         1     289ns     289ns     289ns  cuDeviceComputeCapability
 OpenACC (excl):   77.88%  4.05840s      7200  563.67us  1.6060us  3.6766ms  acc_wait@layers.c:80
                   19.61%  1.02168s      7200  141.90us  1.9140us  1.4865ms  acc_wait@layers.c:60
                    0.67%  34.721ms      3600  9.6440us  5.7940us  799.19us  acc_enqueue_launch@layers.c:60 (_8layers_c_pad_input_60_gpu)
                    0.53%  27.615ms      3600  7.6700us  4.4860us  790.32us  acc_enqueue_launch@layers.c:80 (_8layers_c_conv_forward_80_gpu)
                    0.33%  17.189ms      3600  4.7740us  2.7330us  793.06us  acc_compute_construct@layers.c:60
                    0.30%  15.638ms      3600  4.3430us  2.3750us  811.45us  acc_compute_construct@layers.c:80
                    0.27%  14.234ms      3600  3.9530us  1.9170us  100.50us  acc_enter_data@layers.c:60
                    0.14%  7.3292ms      3600  2.0350us  1.1510us  18.505us  acc_enter_data@layers.c:80
                    0.14%  7.0746ms      3600  1.9650us     969ns  798.10us  acc_exit_data@layers.c:60
                    0.13%  6.5648ms      3600  1.8230us     942ns  19.837us  acc_exit_data@layers.c:80
                    0.01%  524.29us         1  524.29us  524.29us  524.29us  acc_device_init

==1668494== Unified Memory profiling result:
Device "Tesla V100-PCIE-32GB (0)"
   Count  Avg Size  Min Size  Max Size  Total Size  Total Time  Name
   15552  16.178KB  4.0000KB  0.9961MB  245.7109MB  53.10339ms  Host To Device
   22891  10.357KB  4.0000KB  448.00KB  231.5391MB  41.96643ms  Device To Host
    8166         -         -         -           -   1.425459s  Gpu page fault groups
      48         -         -         -           -  12.58382ms  Page throttles
    4006  4.0000KB  4.0000KB  4.0000KB  15.64844MB           -  Memory thrashes
       8  4.0000KB  4.0000KB  4.0000KB  32.00000KB           -  Remote mapping from device
Total CPU Page faults: 15929
Total CPU thrashes: 4006
Total CPU throttles: 34
Total remote mappings to CPU: 8

```

#### 50k images

```
$ ./cnn-cifar10
Parallel (pad) Code
CNN for 50000 images
Loading input batch 1...
Loading input batch 2...
Loading input batch 3...
Loading input batch 4...
Loading input batch 5...
Load Data time:0.543385 seconds
Create Network time:0.001617 seconds
Load Network Parameters time:0.011314 seconds
Create Ouputs time:0.000627 seconds

Net Forward total time:239.967919 seconds
    Time for conv1: 93.458176 seconds
    Time for relu1: 12.831631 seconds
    Time for pool1: 3.626592 seconds
    Time for conv2: 70.340130 seconds
    Time for relu2: 10.607480 seconds
    Time for pool2: 2.829303 seconds
    Time for conv3: 33.426542 seconds
    Time for relu3: 6.589558 seconds
    Time for pool3: 1.100692 seconds
    Time for fc: 5.127136 seconds
    Time for softmax: 0.013117 seconds

  Conv: 197.224848 seconds
  ReLU: 30.028670 seconds
  Pool: 7.556587 seconds
  FC:   5.127136 seconds
  Softmax: 0.013117 seconds

Net Accuracy: 78.84 % 
Net Accuracy time:0.000695 seconds
Free memory time:0.021840 seconds
Total time:240.547397 seconds
END!
```
---
### Parallel, managed, struct-pad, 1200, profile

```
$ nvprof ./cnn-cifar10-profile 
Parallel (pad) Code
CNN for 1200 images
==649157== NVPROF is profiling process 649157, command: ./cnn-cifar10-profile
Loading input batch 1...
Load Data time:0.026012 seconds
Create Network time:0.001412 seconds
Load Network Parameters time:0.007987 seconds
Create Ouputs time:0.000131 seconds

Net Forward total time:6.275401 seconds
    Time for conv1: 2.531005 seconds
    Time for relu1: 0.137797 seconds
    Time for pool1: 0.088365 seconds
    Time for conv2: 1.888635 seconds
    Time for relu2: 0.163610 seconds
    Time for pool2: 0.127265 seconds
    Time for conv3: 0.960923 seconds
    Time for relu3: 0.096763 seconds
    Time for pool3: 0.056891 seconds
    Time for fc: 0.221974 seconds
    Time for softmax: 0.000613 seconds

  Conv: 5.380564 seconds
  ReLU: 0.398169 seconds
  Pool: 0.272521 seconds
  FC:   0.221974 seconds
  Softmax: 0.000613 seconds

Net Accuracy: 78.25 % 
Net Accuracy time:0.000036 seconds
Free memory time:0.000196 seconds
Total time:6.311175 seconds
END!
==649157== Profiling application: ./cnn-cifar10-profile
==649157== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   84.23%  4.29693s      3600  1.1936ms  393.02us  2.7090ms  _8layers_c_conv_forward_80_gpu
                   15.76%  804.04ms      3600  223.35us  52.864us  917.15us  _8layers_c_pad_input_61_gpu
                    0.01%  641.50us         3  213.83us  1.6640us  454.88us  [CUDA memset]
      API calls:   95.57%  5.13800s     14409  356.58us     973ns  3.4258ms  cuStreamSynchronize
                    2.88%  155.10ms         1  155.10ms  155.10ms  155.10ms  cuDevicePrimaryCtxRetain
                    0.87%  46.856ms      7200  6.5070us  3.3680us  816.14us  cuLaunchKernel
                    0.38%  20.693ms         1  20.693ms  20.693ms  20.693ms  cuMemAllocManaged
                    0.11%  5.8567ms     14400     406ns     184ns  237.11us  cuOccupancyMaxActiveBlocksPerMultiprocessor
                    0.08%  4.3024ms         1  4.3024ms  4.3024ms  4.3024ms  cuMemAlloc
                    0.03%  1.7267ms      7209     239ns     123ns  16.634us  cuDeviceGetAttribute
                    0.02%  1.2710ms      1218  1.0430us     241ns  242.70us  cuPointerGetAttributes
                    0.02%  1.2279ms         1  1.2279ms  1.2279ms  1.2279ms  cuMemAllocHost
                    0.01%  740.65us         3  246.88us  14.073us  518.84us  cuMemsetD8
                    0.01%  431.37us         1  431.37us  431.37us  431.37us  cuModuleLoadDataEx
                    0.00%  11.464us         1  11.464us  11.464us  11.464us  cuCtxGetCurrent
                    0.00%  10.283us         1  10.283us  10.283us  10.283us  cuDeviceGetPCIBusId
                    0.00%  2.9150us         3     971ns     163ns  1.9090us  cuCtxSetCurrent
                    0.00%  2.7490us         2  1.3740us     710ns  2.0390us  cuModuleGetFunction
                    0.00%  2.1530us         3     717ns     188ns  1.7220us  cuDeviceGetCount
                    0.00%  1.2820us         2     641ns     425ns     857ns  cuDeviceTotalMem
                    0.00%  1.0830us         3     361ns     203ns     631ns  cuDriverGetVersion
                    0.00%     774ns         2     387ns     177ns     597ns  cuDeviceGet
                    0.00%     713ns         1     713ns     713ns     713ns  cuDeviceComputeCapability
 OpenACC (excl):   80.58%  4.32553s      7200  600.77us  1.5610us  3.4267ms  acc_wait@layers.c:80
                   15.43%  828.13ms      7200  115.02us  1.8770us  2.2391ms  acc_wait@layers.c:61
                    1.85%  99.488ms      3600  27.635us  1.2650us  880.29us  acc_enter_data@layers.c:80
                    0.60%  32.025ms      3600  8.8950us  5.8170us  1.4996ms  acc_enqueue_launch@layers.c:61 (_8layers_c_pad_input_61_gpu)
                    0.50%  26.768ms      3600  7.4350us  4.2700us  807.67us  acc_enqueue_launch@layers.c:80 (_8layers_c_conv_forward_80_gpu)
                    0.27%  14.368ms      3600  3.9910us  2.7820us  214.38us  acc_compute_construct@layers.c:61
                    0.25%  13.606ms      3600  3.7790us  1.9830us  803.46us  acc_enter_data@layers.c:61
                    0.25%  13.468ms      3600  3.7400us  2.3890us  531.58us  acc_compute_construct@layers.c:80
                    0.15%  7.8391ms      3600  2.1770us     955ns  901.65us  acc_exit_data@layers.c:61
                    0.11%  5.6861ms      3600  1.5790us     918ns  96.494us  acc_exit_data@layers.c:80
                    0.01%  516.36us         1  516.36us  516.36us  516.36us  acc_device_init
                    0.00%  195.38us         9  21.709us  6.4860us  122.89us  acc_enter_data@layers.c:42
                    0.00%  60.036us         9  6.6700us     771ns  12.880us  acc_exit_data@layers.c:53
                    0.00%  34.607us         9  3.8450us  1.8100us  18.456us  acc_wait@layers.c:42
                    0.00%  11.432us         3  3.8100us  2.3130us  6.6300us  acc_update@layers.c:296

==649157== Unified Memory profiling result:
Device "Tesla V100-PCIE-32GB (0)"
   Count  Avg Size  Min Size  Max Size  Total Size  Total Time  Name
   15723  15.716KB  4.0000KB  0.9961MB  241.3203MB  55.42295ms  Host To Device
   22864  10.173KB  4.0000KB  448.00KB  227.1523MB  41.49953ms  Device To Host
    9771         -         -         -           -   1.280411s  Gpu page fault groups
     222         -         -         -           -  105.6929ms  Page throttles
    4939  4.0000KB  4.0000KB  4.0000KB  19.29297MB           -  Memory thrashes
      28  4.0000KB  4.0000KB  4.0000KB  112.0000KB           -  Remote mapping from device
Total CPU Page faults: 16208
Total CPU thrashes: 4939
Total CPU throttles: 62
Total remote mappings to CPU: 28
```


#### nvprof
```
$ ./cnn-cifar10 
Parallel (pad) Code
CNN for 1200 images
CUPTI ERROR: cuptiActivityEnable(CUPTI_ACTIVITY_KIND_KERNEL) returned: CUPTI_ERROR_INSUFFICIENT_PRIVILEGES, 
         at ../../src-cupti/prof_cuda_cupti.c:338.
Loading input batch 1...
Load Data time:0.022781 seconds
Create Network time:0.000984 seconds
Load Network Parameters time:0.008054 seconds
Create Ouputs time:0.000040 seconds

Net Forward total time:5.843870 seconds
    Time for conv1: 2.509013 seconds
    Time for relu1: 0.062691 seconds
    Time for pool1: 0.067654 seconds
    Time for conv2: 1.885188 seconds
    Time for relu2: 0.049551 seconds
    Time for pool2: 0.069531 seconds
    Time for conv3: 1.030815 seconds
    Time for relu3: 0.044189 seconds
    Time for pool3: 0.025389 seconds
    Time for fc: 0.099135 seconds
    Time for softmax: 0.000330 seconds

  Conv: 5.425016 seconds
  ReLU: 0.156430 seconds
  Pool: 0.162574 seconds
  FC:   0.099135 seconds
  Softmax: 0.000330 seconds

Net Accuracy: 78.25 % 
Net Accuracy time:0.000049 seconds
Free memory time:0.000097 seconds
Total time:5.875874 seconds
END!

Accelerator Kernel Timing data
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-pad/layers.c
  make_conv_layer  NVIDIA  devicenum=0
    time(us): 0
    42: data region reached 9 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-pad/layers.c
  free_conv  NVIDIA  devicenum=0
    time(us): 0
    53: data region reached 9 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-pad/layers.c
  pad_input  NVIDIA  devicenum=0
    time(us): 0
    61: compute region reached 3600 times
        61: kernel launched 3600 times
            grid: [960]  block: [128]
            elapsed time(us): total=956,294 max=960 min=65 avg=265
    61: data region reached 7200 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-pad/layers.c
  conv_forward  NVIDIA  devicenum=0
    time(us): 0
    80: compute region reached 3600 times
        80: kernel launched 3600 times
            grid: [400]  block: [128]
            elapsed time(us): total=4,373,169 max=2,491 min=439 avg=1,214
    80: data region reached 7200 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-pad/layers.c
  load_conv  NVIDIA  devicenum=0
    time(us): 0
    296: update directive reached 3 times
```

### Parallel, managed, struct-pad, 50k, profile

#### nvprof
```
$ nvprof ./cnn-cifar10-profile 
Parallel (pad) Code
CNN for 50000 images
==609769== NVPROF is profiling process 609769, command: ./cnn-cifar10-profile
Loading input batch 1...
Loading input batch 2...
Loading input batch 3...
Loading input batch 4...
Loading input batch 5...
Load Data time:0.892674 seconds
Create Network time:0.002188 seconds
Load Network Parameters time:0.008230 seconds
Create Ouputs time:0.000811 seconds

Net Forward total time:310.190234 seconds
    Time for conv1: 104.962387 seconds
    Time for relu1: 22.961910 seconds
    Time for pool1: 5.096130 seconds
    Time for conv2: 80.003359 seconds
    Time for relu2: 22.934966 seconds
    Time for pool2: 4.932743 seconds
    Time for conv3: 43.075883 seconds
    Time for relu3: 13.159397 seconds
    Time for pool3: 2.158208 seconds
    Time for fc: 10.857713 seconds
    Time for softmax: 0.017873 seconds

  Conv: 228.041628 seconds
  ReLU: 59.056274 seconds
  Pool: 12.187082 seconds
  FC:   10.857713 seconds
  Softmax: 0.017873 seconds

Net Accuracy: 78.84 % 
Net Accuracy time:0.000720 seconds
Free memory time:0.020625 seconds
Total time:311.115481 seconds
END!
==609769== Profiling application: ./cnn-cifar10-profile
==609769== Profiling result:
            Type  Time(%)      Time     Calls       Avg       Min       Max  Name
 GPU activities:   81.03%  172.925s    150000  1.1528ms  364.16us  5.8219ms  _8layers_c_conv_forward_80_gpu
                   18.97%  40.4954s    150000  269.97us  51.455us  5.0774ms  _8layers_c_pad_input_61_gpu
                    0.00%  732.44us         3  244.15us  75.903us  439.39us  [CUDA memset]
      API calls:   98.90%  214.660s    600009  357.76us  1.0300us  5.8225ms  cuStreamSynchronize
                    0.82%  1.77665s    300000  5.9220us  3.4160us  2.2794ms  cuLaunchKernel
                    0.10%  224.50ms    600000     374ns     179ns  871.60us  cuOccupancyMaxActiveBlocksPerMultiprocessor
                    0.10%  222.96ms         1  222.96ms  222.96ms  222.96ms  cuDevicePrimaryCtxRetain
                    0.04%  76.677ms    300009     255ns     134ns  796.72us  cuDeviceGetAttribute
                    0.02%  34.286ms     50028     685ns     218ns  659.22us  cuPointerGetAttributes
                    0.01%  20.798ms         2  10.399ms  115.97us  20.682ms  cuMemAllocManaged
                    0.01%  20.482ms         1  20.482ms  20.482ms  20.482ms  cuMemFree
                    0.00%  1.2997ms         1  1.2997ms  1.2997ms  1.2997ms  cuMemAllocHost
                    0.00%  894.30us         3  298.10us  88.935us  566.35us  cuMemsetD8
                    0.00%  439.94us         1  439.94us  439.94us  439.94us  cuModuleLoadDataEx
                    0.00%  121.57us         1  121.57us  121.57us  121.57us  cuMemAlloc
                    0.00%  13.017us         2  6.5080us     513ns  12.504us  cuModuleGetFunction
                    0.00%  10.498us         1  10.498us  10.498us  10.498us  cuDeviceGetPCIBusId
                    0.00%  3.5450us         2  1.7720us     123ns  3.4220us  cuDeviceTotalMem
                    0.00%  3.1740us         3  1.0580us     262ns  1.9170us  cuCtxSetCurrent
                    0.00%  1.9040us         3     634ns     172ns  1.5280us  cuDeviceGetCount
                    0.00%     884ns         3     294ns     141ns     531ns  cuDriverGetVersion
                    0.00%     676ns         1     676ns     676ns     676ns  cuDeviceComputeCapability
                    0.00%     594ns         2     297ns     157ns     437ns  cuDeviceGet
                    0.00%     537ns         1     537ns     537ns     537ns  cuCtxGetCurrent
 OpenACC (excl):   76.44%  173.945s    300000  579.82us  1.6290us  5.8259ms  acc_wait@layers.c:80
                   18.17%  41.3496s    300000  137.83us  1.8760us  5.0820ms  acc_wait@layers.c:61
                    3.50%  7.96963s    150000  53.130us  1.2550us  11.196ms  acc_enter_data@layers.c:80
                    0.50%  1.13555s    150000  7.5700us  5.6940us  1.3448ms  acc_enqueue_launch@layers.c:61 (_8layers_c_pad_input_61_gpu)
                    0.48%  1.09746s    150000  7.3160us  4.3630us  2.2829ms  acc_enqueue_launch@layers.c:80 (_8layers_c_conv_forward_80_gpu)
                    0.25%  563.67ms    150000  3.7570us  2.7510us  1.0883ms  acc_compute_construct@layers.c:61
                    0.24%  554.28ms    150000  3.6950us  2.4180us  1.7667ms  acc_compute_construct@layers.c:80
                    0.22%  507.65ms    150000  3.3840us  1.8640us  2.0477ms  acc_enter_data@layers.c:61
                    0.10%  218.54ms    150000  1.4560us     906ns  813.10us  acc_exit_data@layers.c:80
                    0.09%  213.27ms    150000  1.4210us     981ns  801.80us  acc_exit_data@layers.c:61
                    0.00%  529.60us         1  529.60us  529.60us  529.60us  acc_device_init
                    0.00%  180.76us         9  20.084us  3.3920us  107.37us  acc_enter_data@layers.c:42
                    0.00%  42.828us         9  4.7580us     728ns  20.616us  acc_exit_data@layers.c:53
                    0.00%  28.609us         9  3.1780us  1.8060us  12.495us  acc_wait@layers.c:42
                    0.00%  10.612us         3  3.5370us  2.0870us  5.6460us  acc_update@layers.c:296

==609769== Unified Memory profiling result:
Device "Tesla V100-PCIE-32GB (0)"
   Count  Avg Size  Min Size  Max Size  Total Size  Total Time  Name
  725027  20.124KB  4.0000KB  0.9961MB  13.91497GB   2.779784s  Host To Device
 2289076  6.1113KB  4.0000KB  252.00KB  13.34262GB   3.462761s  Device To Host
  299386         -         -         -           -  65.292323s  Gpu page fault groups
     445         -         -         -           -  233.6201ms  Page throttles
  416512  4.0000KB  4.0000KB  4.0000KB  1.588867GB           -  Memory thrashes
      60  4.0000KB  4.0000KB  4.0000KB  240.0000KB           -  Remote mapping from device
Total CPU Page faults: 1935281
Total CPU thrashes: 416512
Total CPU throttles: 190
Total remote mappings to CPU: 60
```
#### NV_ACC_TIME
```
$ ./cnn-cifar10 
Parallel (pad) Code
CNN for 50000 images
CUPTI ERROR: cuptiActivityEnable(CUPTI_ACTIVITY_KIND_KERNEL) returned: CUPTI_ERROR_INSUFFICIENT_PRIVILEGES, 
         at ../../src-cupti/prof_cuda_cupti.c:338.
Loading input batch 1...
Loading input batch 2...
Loading input batch 3...
Loading input batch 4...
Loading input batch 5...
Load Data time:0.582867 seconds
Create Network time:0.001689 seconds
Load Network Parameters time:0.008533 seconds
Create Ouputs time:0.000643 seconds

Net Forward total time:251.175803 seconds
    Time for conv1: 95.312213 seconds
    Time for relu1: 11.206251 seconds
    Time for pool1: 3.145062 seconds
    Time for conv2: 77.949277 seconds
    Time for relu2: 9.941082 seconds
    Time for pool2: 2.816316 seconds
    Time for conv3: 41.150042 seconds
    Time for relu3: 4.215646 seconds
    Time for pool3: 0.174193 seconds
    Time for fc: 5.236835 seconds
    Time for softmax: 0.012481 seconds

  Conv: 214.411532 seconds
  ReLU: 25.362980 seconds
  Pool: 6.135570 seconds
  FC:   5.236835 seconds
  Softmax: 0.012481 seconds

Net Accuracy: 78.84 % 
Net Accuracy time:0.001009 seconds
Free memory time:0.021306 seconds
Total time:251.791849 seconds
END!

Accelerator Kernel Timing data
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-pad/layers.c
  make_conv_layer  NVIDIA  devicenum=0
    time(us): 0
    42: data region reached 9 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-pad/layers.c
  free_conv  NVIDIA  devicenum=0
    time(us): 0
    53: data region reached 9 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-pad/layers.c
  pad_input  NVIDIA  devicenum=0
    time(us): 0
    61: compute region reached 150000 times
        61: kernel launched 150000 times
            grid: [960]  block: [128]
            elapsed time(us): total=44,571,643 max=9,869 min=64 avg=297
    61: data region reached 300000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-pad/layers.c
  conv_forward  NVIDIA  devicenum=0
    time(us): 0
    80: compute region reached 150000 times
        80: kernel launched 150000 times
            grid: [400]  block: [128]
            elapsed time(us): total=165,459,957 max=4,750 min=369 avg=1,103
    80: data region reached 300000 times
/home/olia/Diplomatiki/cnn-cifar10_0/serial2parallel-pad/layers.c
  load_conv  NVIDIA  devicenum=0
    time(us): 0
    296: update directive reached 3 times
```